{"hash":"8ccb09ad5064a821b53527af2e38621355ce8005","data":{"tag":{"title":"Blog","belongsTo":{"edges":[{"node":{"title":"为 Gridsome 添加 Artalk 自托管评论系统","path":"/code/use-self-hosted-comment-system-in-gridsome/","date":"August 21. 2020","timeToRead":4,"cjkWordCount":2714,"cjkReadTime":12,"description":"考虑到小站的访客还不是人均科学上网的水平，我折腾了一天从 Disqus 换到了友链写的自托管评论系统 Artalk，数据迁移啥就以后再说吧，咕咕咕..","content":"<p>本文介绍在 Gridsome 博客中启用 Artalk 自托管评论系统的方法。欢迎尝试这款小众的、漂亮的评论系统！</p>\n<p>刚开这个小站时打算一劳永逸吃上 Disqus 这块香饽饽，结果没两天我的宝贝室友就跟我说：你站怎么没法评论啊？我深思熟虑之后决定还是不用 Disqus 了。换 Gitalk？不行不行，Gitalk 虽好但是每一个新站点都需要 GitHub 账号授权一次，而且国内访问也体验不佳。Valine 之流我不太喜欢，其他的评论系统我都不甚了解。那该何去何从呢？</p>\n<h2 id=\"选择-artalk-的理由\"><a href=\"#%E9%80%89%E6%8B%A9-artalk-%E7%9A%84%E7%90%86%E7%94%B1\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>选择 Artalk 的理由</h2>\n<p>由于水平不足，我是没法自己写一个评论系统的，于是我决定在友链 <a href=\"https://qwqaq.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">@QWQAQ</a> 和 <a href=\"https://www.ouorz.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">@TonyHe</a> 两位大佬的两个评论系统里选一个，要知道缝合代码、借用轮子这种事我最擅长了。那么是用 <a href=\"https://github.com/qwqcode/Artalk\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">@qwqcode/Artalk</a> 还是 <a href=\"https://github.com/HelipengTony/nexment\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">@HelipengTony/nexment</a> 呢？</p>\n<p>外行人看热闹，我以一个前端菜鸟的水平不足以在架构上对两个评论系统做出优劣比较，所以以下只是我个人选择的理由。</p>\n<p>Nexment 是 <del>React.js 编写</del> 「计划全平台、全框架适配」的基于 LeanCloud 实现 Serverless 的评论系统，官方提供了 React.js 和 Vue.js 示例，有自己的文档（虽然 Tony 好像还没有写详细，但至少有一个站点在那）。官方示例站点 <a href=\"https://nexment-demo.ouorz.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Nextment for React Demo</a> / <a href=\"https://nexment-vue-demo.ouorz.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Nextment for Vue Demo</a>，我觉得新颖的点在弹窗显示多级评论上，在我逛的博客圈子里比较少见。部署的话需要提前配置 LeanCloud 的数据库，这让我停止了思考（我的数据库放在别人那里想想就不靠谱啊喂）。Nexment 诞生于最近一月，截至本文发布前最后一次提交在三天前，作者 TonyHe 感觉是个努力 Coding 的巨佬，毕竟即将出国留学了。</p>\n<p>Artalk 是 TypeScript 编写的需要自行部署后端的「一款简洁有趣的自托管评论系统」，数据存放在 JSON 文件中，后续听说也计划增加 MySQL 的支持（我：那样听起来就不太简洁了呢）。需要自行搭建后端估计劝退了很多人，而且目前只支持 PHP 后端，README 里写的 Go、Node.js、Python 后端均迟迟未上线。官方给的示例只有几个 HTML，相当的「简洁」，基本都是在 HTML 引入 <code>Artalk.css</code> <code>Artalk.js</code> 后一些简单的配置。官方示例站点 <a href=\"https://artalk.js.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Artalk DEMO</a>，听说在这里可以观察到开发者立 Flag 现场。Artalk 诞生于 2018 年 10 月，截至本文发布前最后一次提交在今年 5 月，考虑到作者 QWQAQ 的学业繁忙，摸鱼也是可以理解的。</p>\n<p>简单了解两个评论系统之后，再看自身的 Gridsome 平台，基于 Vue.js。怎么看我都应该选择 Nexment，但是我却选择了 Artalk。原因嘛，自然是图个简单。Artalk 之前就搭建了自己的后端使用过一段时间，官方搭配的滑稽表情包在别的评论系统一众阿鲁表情包、贴吧表情包中独树一帜。更重要的是 Artalk 的代码我能看懂一些，进行自定义修改很方便。Nexment 虽好，但是外观相比 Artalk 我还是更喜欢后者，弹窗多级评论显示对我来说也需求不高，要我看 React.js 项目代码更是劝退。</p>\n<h2 id=\"对-artalk-的修改\"><a href=\"#%E5%AF%B9-artalk-%E7%9A%84%E4%BF%AE%E6%94%B9\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>对 Artalk 的修改</h2>\n<p>Artalk 目前还没有支持夜间模式，原本的样式和本站也不太搭。于是我 Fork 了一份代码针对这两个问题进行修改。</p>\n<p>夜间模式主要按照当前主题和 Disqus 的配色、样式进行调整。其实之前也尝试配过一个夜间模式，用在自己修改后的 Typecho 主题上，但是代码过于粗糙。我调整颜色的方法甚至是直接将原版压缩后的 <code>.css</code> 打开后按 <code>Ctrl</code> <code>F2</code> 全部替换！剩下的样式代码压缩后即使找工具美化也看的我云里雾里。这次直接克隆仓库安装依赖从源头编译，方便那不是一星半点！</p>\n<p>到本文发布为止，我共进行了十余次提交，主要对以下这些地方进行了修改：</p>\n<ul>\n<li>夜间模式</li>\n<li>小屏幕样式部分适配</li>\n<li>控制台版权去除</li>\n<li>「Power By Artalk」 调整</li>\n<li>侧边栏通知中心细节调整</li>\n</ul>\n<p>夜间模式的配色均在 <a href=\"https://github.com/monsterxcn/Artalk/blob/master/src/css/_variables.less\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">_variables.less</a> 中定义，以 <code>--at-</code> 为前缀。GitHub 仓库地址 <a href=\"https://github.com/monsterxcn/Artalk\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">@monsterxcn/Artalk</a>，我搭了个示例站点 <a href=\"https://artalk.vercel.app\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Artalk ♂</a>。</p>\n<h2 id=\"在-gridsome-上调试\"><a href=\"#%E5%9C%A8-gridsome-%E4%B8%8A%E8%B0%83%E8%AF%95\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>在 Gridsome 上调试</h2>\n<p>刚使用 Gridsome 大约一周，对它的了解很少，Vue.js 水平连门都入不了。但是这样的我还是花了几个小时将 Artalk 成功适配到了博客。中间踩了几个坑在这里提一下解决方法。</p>\n<h3 id=\"安装-artalk\"><a href=\"#%E5%AE%89%E8%A3%85-artalk\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>安装 Artalk</h3>\n<p>Artalk 提供了 npm 包，所以可以直接在命令行安装</p>\n<pre class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> artalk --save<span class=\"line-numbers-rows\" aria-hidden=\"true\"><span></span></span></code></pre>\n<p>如果需要安装我修改之后的版本则需要在 <code>package.json</code> 中手动写入仓库地址：</p>\n<pre class=\"language-diff line-numbers\"><code class=\"language-diff\">{\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> \"name\": \"gridsome-starter-blog\",\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> \"private\": true,\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> \"scripts\": {\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   \"build\": \"gridsome build\",\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   \"develop\": \"gridsome develop\",\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   \"explore\": \"gridsome explore\"\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> },\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> \"dependencies\": {\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   \"@gridsome/plugin-google-analytics\": \"^0.1.0\",\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   \"@gridsome/remark-prismjs\": \"^0.2.0\",\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   \"@gridsome/source-filesystem\": \"^0.6.0\",\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   \"@gridsome/transformer-remark\": \"^0.3.0\",\n</span></span><span class=\"token deleted-sign deleted\"><span class=\"token prefix deleted\">-</span><span class=\"token line\">   \"gridsome\": \"^0.7.0\"\n</span></span><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\">   \"gridsome\": \"^0.7.0\",\n</span><span class=\"token prefix inserted\">+</span><span class=\"token line\">   \"artalk\": \"https://github.com/monsterxcn/Artalk.git\",\n</span></span><span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> },\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> \"devDependencies\": {\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   \"node-sass\": \"^4.12.0\",\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   \"sass-loader\": \"^8.0.0\"\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> }\n</span></span>}<span class=\"line-numbers-rows\" aria-hidden=\"true\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>这里 L16 会直接引用我修改后的最新开发版，但是如果用于自动构建发布站点的 GitHub Actions 中使用了依赖缓存，则总是使用第一次执行工作流时安装的版本，无法获得后续更新。为了解决这一问题，将 Git 链接修改为指定 commit 时刻的地址即可。当前推荐版本为：</p>\n<pre class=\"language-text line-numbers\"><code class=\"language-text\">https://github.com/monsterxcn/Artalk.git#53234915564517ee5d5f7bfe3553fdba1b6f6a5f<span class=\"line-numbers-rows\" aria-hidden=\"true\"><span></span></span></code></pre>\n<h3 id=\"引入-artalkcss\"><a href=\"#%E5%BC%95%E5%85%A5-artalkcss\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>引入 <code>Artalk.css</code></h3>\n<p>接下来引用 <code>Artalk.css</code> 和 <code>Artalk.js</code>，建议单独新建 <code>ArtalkCards.vue</code> 文件存放 Artalk 评论组件的代码，只在该模板中引入 <code>Artalk.css</code> 即可。</p>\n<pre class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword module\">import</span> <span class=\"token string\">'artalk/dist/Artalk.css'</span><span class=\"line-numbers-rows\" aria-hidden=\"true\"><span></span></span></code></pre>\n<p>当前不必要的 <code>.css</code> 文件我们都让它在不得不引入时再加载</p>\n<h3 id=\"引入-artalkjs\"><a href=\"#%E5%BC%95%E5%85%A5-artalkjs\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>引入 <code>Artalk.js</code></h3>\n<p>最初引入 <code>Artalk.js</code> 时，我参考主题使用 DisqusJS 的方法在 <code>.vue</code> 模板文件的 <code>&#x3C;script></code> 标签中这样写：</p>\n<pre class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword module\">import</span> <span class=\"token string\">'artalk/dist/Artalk.css'</span>\n<span class=\"token keyword module\">import</span> <span class=\"token maybe-class-name\">Artalk</span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'artalk'</span>\n\n<span class=\"token keyword module\">export</span> <span class=\"token keyword module\">default</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token comment\">// ...</span>\n\n  <span class=\"token function\">mounted</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Initialize post comment by Artalk</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">===</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">var</span> artalk <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Artalk</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        el<span class=\"token operator\">:</span> <span class=\"token string\">'#artalkcomments'</span><span class=\"token punctuation\">,</span>\n        placeholder<span class=\"token operator\">:</span> <span class=\"token string\">'说点什么 (づ￣ 3￣)づ'</span><span class=\"token punctuation\">,</span>\n        defaultAvatar<span class=\"token operator\">:</span> <span class=\"token string\">'mp'</span><span class=\"token punctuation\">,</span>\n        pageKey<span class=\"token operator\">:</span> <span class=\"token string\">'https://blog.monsterx.cn/some-page/'</span><span class=\"token punctuation\">,</span>\n        serverUrl<span class=\"token operator\">:</span> <span class=\"token string\">'https://lab.mocurio.com/artalk/'</span><span class=\"token punctuation\">,</span>\n        readMore<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          pageSize<span class=\"token operator\">:</span> <span class=\"token number\">15</span><span class=\"token punctuation\">,</span>\n          autoLoad<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"line-numbers-rows\" aria-hidden=\"true\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p><code>gridsome develop</code> 预览正常，但是发布时遇到「ReferenceError: window is not defined」，提示的报错信息都来自 <code>node_modules/artalk/dist/Artalk.js</code>，我以为是自己修改 Artalk 出的问题，于是又回去修改 Artalk 代码，将网上用来解决这个问题的几个方法都试了一遍依旧报错。正当我迷惑时，突然想到了 Gridsome 的源头 Vue.js 本身，于是我一拍脑袋在搜索时加了关键词 <code>gridsome</code>，这才发现原来和「Client API」有关。</p>\n<p>几个参考链接《<a href=\"https://stackoverflow.com/questions/40707481/window-is-not-defined-in-vue-js-2\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">javascript - 'window' is not defined in Vue.js 2 - Stack Overflow</a>》《<a href=\"https://github.com/gridsome/gridsome/issues/646\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Failed to render / ReferenceError: window is not defined (vue2-leaflet) - issue #646 - GitHub @gridsome/gridsome</a>》《<a href=\"https://gridsome.org/docs/client-api/#isclient\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Client API - Gridsome</a>》</p>\n<p>虽然不知道这是个什么东西，但是大概说的是有些代码只能在客户端跑，服务端无法 <del>执行</del>「渲染」，比如 <code>window</code> 的操作。要说专业点，应该是关乎 S(erver) S(ide) R(ender)「服务器端渲染」的机制。根据上面第二个链接中 <a href=\"https://github.com/gridsome/gridsome/issues/646#issuecomment-578367659\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">IHIutch 的回答</a>，成功找到了解决方案：</p>\n<pre class=\"language-diff line-numbers\"><code class=\"language-diff\">import 'artalk/dist/Artalk.css'\n<span class=\"token deleted-sign deleted\"><span class=\"token prefix deleted\">-</span><span class=\"token line\">import Artalk from 'artalk'\n</span></span><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\">let Artalk = {}\n</span></span>\nexport default {\n\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> // ...\n</span></span>\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> mounted() {\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   // Initialize post comment by Artalk\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   if (process.env.NODE_ENV === 'production') {\n</span></span><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\">     Artalk = require('artalk')\n</span></span><span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\">     var artalk = new Artalk({\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">       el: '#artalkcomments',\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">       placeholder: '说点什么 (づ￣ 3￣)づ',\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">       defaultAvatar: 'mp',\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">       pageKey: 'https://blog.monsterx.cn/some-page/',\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">       serverUrl: 'https://lab.mocurio.com/artalk/',\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">       readMore: {\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">         pageSize: 15,\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">         autoLoad: true,\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">       },\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">     })\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   }\n</span><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> },\n</span></span>}<span class=\"line-numbers-rows\" aria-hidden=\"true\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>L11 <code>process.env.NODE_ENV === 'production'</code> 和 <code>process.isClient</code> 实际效果应该都差不多。</p>\n<h2 id=\"最终模板\"><a href=\"#%E6%9C%80%E7%BB%88%E6%A8%A1%E6%9D%BF\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>最终模板</h2>\n<p><del>在 <code>/src/components</code> 新建 <code>ArtalkCards.vue</code> 作为 Artalk 评论区模板</del> 我对 Gridsome 的模板还不太熟悉，总之直接在需要引入评论区的页面直接加好了：</p>\n<pre class=\"language-html line-numbers\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>template</span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token comment\">&lt;!-- --></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>artalk-cards<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>details</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>admonition admonition-warning<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>summary</span><span class=\"token punctuation\">></span></span>\n        Comment on this blog\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>summary</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>\n        评论如无特殊原因均不会被删除，提交前请三思。<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span> <span class=\"token punctuation\">/></span></span>\n        你应该懂得如何发表适当的观点，请对自己的言论负责。\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>details</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>LetsArtalk<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token comment\">&lt;!-- --></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>template</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n<span class=\"token comment\">// ...</span>\n\n<span class=\"token keyword module\">import</span> <span class=\"token string\">'artalk/dist/Artalk.css'</span>\n<span class=\"token keyword\">let</span> <span class=\"token maybe-class-name\">Artalk</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token keyword module\">export</span> <span class=\"token keyword module\">default</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token comment\">// ...</span>\n\n  <span class=\"token function\">mounted</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">// ...</span>\n\n    <span class=\"token comment\">// Initialize post comment by Artalk</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">===</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token maybe-class-name\">Artalk</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'artalk'</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">var</span> artalk <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Artalk</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        el<span class=\"token operator\">:</span> <span class=\"token string\">'#LetsArtalk'</span><span class=\"token punctuation\">,</span>\n        placeholder<span class=\"token operator\">:</span> <span class=\"token string\">'说点什么 (づ￣ 3￣)づ'</span><span class=\"token punctuation\">,</span>\n        defaultAvatar<span class=\"token operator\">:</span> <span class=\"token string\">'mp'</span><span class=\"token punctuation\">,</span>\n        pageKey<span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">$page</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">post</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">path</span><span class=\"token punctuation\">,</span>\n        serverUrl<span class=\"token operator\">:</span> <span class=\"token string\">'https://lab.mocurio.com/artalk/'</span><span class=\"token punctuation\">,</span>\n        readMore<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          pageSize<span class=\"token operator\">:</span> <span class=\"token number\">15</span><span class=\"token punctuation\">,</span>\n          autoLoad<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>page-query</span><span class=\"token punctuation\">></span></span>\nquery Post ($id: ID!) {\n\n  // ...\n\n  post: post (id: $id) {\n    path\n  }\n}\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>page-query</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>style</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>scss<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token style\"><span class=\"token language-css\">\n<span class=\"token selector\"><span class=\"token class\">.artalk-cards</span></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">background</span><span class=\"token punctuation\">:</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span><span class=\"token variable\">--at-bg-main</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">border-radius</span><span class=\"token punctuation\">:</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span><span class=\"token variable\">--radius</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">max-width</span><span class=\"token punctuation\">:</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span><span class=\"token variable\">--content-width</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">margin</span><span class=\"token punctuation\">:</span> <span class=\"token number\">20</span><span class=\"token unit\">px</span> auto <span class=\"token number\">100</span><span class=\"token unit\">px</span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">box-shadow</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token unit\">px</span> <span class=\"token number\">1</span><span class=\"token unit\">px</span> <span class=\"token number\">5</span><span class=\"token unit\">px</span> <span class=\"token number\">0</span> <span class=\"token color\"><span class=\"token function\">rgba</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.02</span><span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">,</span>\n    <span class=\"token number\">1</span><span class=\"token unit\">px</span> <span class=\"token number\">1</span><span class=\"token unit\">px</span> <span class=\"token number\">15</span><span class=\"token unit\">px</span> <span class=\"token number\">0</span> <span class=\"token color\"><span class=\"token function\">rgba</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.03</span><span class=\"token punctuation\">)</span></span><span class=\"token selector\">;\n  details</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">margin</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span> auto<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">text-align</span><span class=\"token punctuation\">:</span> center<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">border-top-left-radius</span><span class=\"token punctuation\">:</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span><span class=\"token variable\">--radius</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token property\">border-top-right-radius</span><span class=\"token punctuation\">:</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span><span class=\"token variable\">--radius</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token property\">outline</span><span class=\"token punctuation\">:</span> none<span class=\"token selector\">;\n    summary</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">list-style</span><span class=\"token punctuation\">:</span> none<span class=\"token punctuation\">;</span>\n      <span class=\"token property\">margin</span><span class=\"token punctuation\">:</span> <span class=\"token number\">4</span><span class=\"token unit\">px</span> auto <span class=\"token important\">!important</span><span class=\"token punctuation\">;</span>\n      <span class=\"token property\">color</span><span class=\"token punctuation\">:</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span><span class=\"token variable\">--cb-admonition-icon-color</span><span class=\"token punctuation\">)</span> <span class=\"token important\">!important</span><span class=\"token punctuation\">;</span>\n      <span class=\"token property\">margin</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2.75</span><span class=\"token unit\">rem</span> <span class=\"token number\">0</span> <span class=\"token number\">1</span><span class=\"token unit\">rem</span><span class=\"token punctuation\">;</span>\n      <span class=\"token property\">font-family</span><span class=\"token punctuation\">:</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span><span class=\"token variable\">--title-font-family</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token property\">font-weight</span><span class=\"token punctuation\">:</span> <span class=\"token number\">600</span><span class=\"token punctuation\">;</span>\n      <span class=\"token property\">line-height</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1.5</span><span class=\"token punctuation\">;</span>\n      <span class=\"token property\">outline</span><span class=\"token punctuation\">:</span> none<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token selector\">summary<span class=\"token pseudo-element\">::-webkit-details-marker</span></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> none<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token selector\">p</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">color</span><span class=\"token punctuation\">:</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span><span class=\"token variable\">--at-font-color</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token property\">font-weight</span><span class=\"token punctuation\">:</span> <span class=\"token number\">500</span><span class=\"token punctuation\">;</span>\n      <span class=\"token property\">margin-bottom</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token selector\"><span class=\"token id\">#LetsArtalk</span></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">padding</span><span class=\"token punctuation\">:</span> <span class=\"token number\">20</span><span class=\"token unit\">px</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token atrule\"><span class=\"token rule\">@media</span> screen <span class=\"token keyword\">and</span> <span class=\"token punctuation\">(</span><span class=\"token property\">max-width</span><span class=\"token punctuation\">:</span> <span class=\"token number\">767.5</span><span class=\"token unit\">px</span><span class=\"token punctuation\">)</span></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token selector\">details <span class=\"token combinator\">></span> p</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">text-align</span><span class=\"token punctuation\">:</span> left<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token selector\"><span class=\"token id\">#LetsArtalk</span></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">padding</span><span class=\"token punctuation\">:</span> <span class=\"token number\">20</span><span class=\"token unit\">px</span> <span class=\"token number\">0</span> <span class=\"token number\">0</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/** */</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>style</span><span class=\"token punctuation\">></span></span><span class=\"line-numbers-rows\" aria-hidden=\"true\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>根据需要自己修改下 <code>&#x3C;template></code> 的内容，注意保证只存在一个「主标签」，比如我的是 <code>&#x3C;div class=\"artalk-cards\"></code>。修改 L29-37 为自己的 Artalk 参数，<code>pageKey</code> 需要自行拼接为页面 URL，否则后端发送的邮件中「查看回复」按钮可能链接到奇怪的地方导致体验极差，其他参数查阅 <a href=\"https://github.com/monsterxcn/Artalk/blob/master/types/artalk-config.d.ts\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">artalk-config.d.ts</a>。<code>&#x3C;style></code> 是我针对当前主题做的一点适配。</p>\n<p>考虑到能看到这里并且有意愿尝试 Artalk 的人应该极少，我悄悄说一句大家可以使用我搭的 Artalk PHP 后端做做测试，它运行在阿里云 <del>北京</del> 上海学生机，并发访问除了我自己的站点应该就没了，而我自己的站点访问也很少，所以服务器压力不大，给大家玩玩还是可以的。将配置中的 <code>serverUrl</code> 字段填写为 <code>https://lab.monsterx.cn/ArtalkAPI</code> 来使用本站后端，跨域访问目前是允许的，不必向我申请。</p>\n<blockquote>\n<p>其实通过 phpcomposer 安装搭建 Artalk PHP 后端也十分简单，担心引用本站后端存在数据安全或其他问题可以尝试自行搭建。以后有空可能写一篇 Docker Artalk PHP 后端的文。如果对上述内容有问题欢迎留言。</p>\n</blockquote>\n"}},{"node":{"title":"新起点 × 博客中文排版","path":"/life/new-start-with-gridsome/","date":"August 15. 2020","timeToRead":1,"cjkWordCount":1411,"cjkReadTime":7,"description":"在这普通的一天，这个普通的博客诞生 / 重生了。本文简单介绍下目前的情况、新的中文格式排版和 Markdown 规则以及从旧的 Typecho 手动迁移时一些琐碎的记录。","content":"<p>在这普通的一天，我穿着普通的鞋，很普通地呆在这普通的家，掏出普通的耳机，找点普通的感觉，来一首我最爱的普通音乐，踩着普通的鼓点，世界随着我旋转，这让我普通地单曲循环，跟着普通的节奏，手腕普通地抖动，这普通的一切，都变得不同……</p>\n<h2 id=\"新的平台\"><a href=\"#%E6%96%B0%E7%9A%84%E5%B9%B3%E5%8F%B0\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>新的平台</h2>\n<p>博客稳定两周年之际，我正式从动态博客迁移至静态博客，如你所见这个博客正由 <a href=\"https://gridsome.org\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Gridsome</a> 驱动着。「Gridsome 是一个免费、开源、基于 Vue.js 构建的框架，用 Gridsome 创建的网站和应用程序具有天然的速度优势」，身边用 <a href=\"https://hexo.io\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Hexo</a> 的人似乎太多了，喜欢尝试小众作品的我选择了 Gridsome。除此之外，似乎是从给旧站点加了 Statusbot <a href=\"https://status.monsterx.cn\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">状态监控</a> 开始站内垃圾评论数量陡增，一直在用 Typecho 原生评论的我实在顶不住，评论拦截插件虽然也有，但都不太能满足我的需求，索性换个评论系统加入大家都说好的 Disqus 大家族了。</p>\n<p>使用 Disqus 的痛处其一是评论数据同步，手动导入了两篇文章的数据之后发现评论区头像都无法显示，网上的解决方案似乎得购买 Disqus 商业套餐。其二是国内用户上网环境不佳便无法评论，向来冷清的本站雪上加霜，以后可能会考虑在国内服务器上继续部署 <a href=\"https://lab.mocurio.com/artalk.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Artalk</a> 评论系统以供 <del>小部分人的需求</del> 自娱自乐。</p>\n<p>本站的主题参考 <a href=\"https://blog.spencerwoo.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">@Spencer's Blog</a> 和 <a href=\"https://blog.jalenchuh.cn\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">@Jalen's Blog</a> 的仓库修改，基于 <a href=\"https://github.com/gridsome/gridsome-starter-blog\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">@gridsome/gridsome-starter-blog</a>。静态博客可以自由部署在很多地方，目前这个博客通过 GitHub Actions 自动构建静态文件发布到私有仓库的分支和阿里云 OSS，配合阿里云全站加速供中国境内访问，同时部署到 Cloudflare Workers Sites 供境外访问。以前将域名的境内境外解析拆分，是考虑国外可能会有人访问，现在想明白了，这其实是为了国内日常科学上网的同志们。就算是「人在纽约」访问本站应该也能获取稍快的体验。</p>\n<h2 id=\"文章排版\"><a href=\"#%E6%96%87%E7%AB%A0%E6%8E%92%E7%89%88\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>文章排版</h2>\n<p>格式工整的文章让人阅读的欲望更强烈。参照众多中文博客排版、GitHub 热门项目文档排版、GitHub 仓库 <a href=\"https://github.com/sparanoid/chinese-copywriting-guidelines\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">@sparanoid/chinese-copywriting-guidelines</a> 以及我的个人偏好，将本博客的 Markdown 文件书写规则做一点说明，有冲突时优先考虑下文的规则。</p>\n<ul>\n<li>\n<p>标点符号</p>\n<ul>\n<li>中文内容不掺杂半角标点符号，英文内容不掺杂全角标点符号</li>\n<li>中文内容使用全角直角引号代替全角双引号</li>\n<li>数字内容使用半角字符</li>\n<li>不使用重复的标点符号，「...」除外</li>\n<li>内容必须以标点符号结尾，表格、列表、代码除外</li>\n</ul>\n</li>\n<li>\n<p>空格</p>\n<ul>\n<li>中英文之间留空格，（按照官方格式书写）</li>\n<li>中文与数字、数字与单位（「°」「℃」「%」除外）之间留空格</li>\n<li>全角标点符号前后不留空格</li>\n<li>省略号「……」后留一个空格</li>\n</ul>\n</li>\n<li>\n<p>名词</p>\n<ul>\n<li>「豆瓣FM」等同时包含中英文的产品名词按照官方格式书写</li>\n<li>专有名词使用官方格式的大小写和缩写</li>\n</ul>\n</li>\n<li>\n<p>Markdown</p>\n<ul>\n<li>Markdown 语法优先于 HTML 标签</li>\n<li>Markdown 标题从 <code>##</code> 开始，按内容相关度分段</li>\n<li>Markdown 语法与前后正文内容之间留一个空格，全角标点符号除外</li>\n</ul>\n</li>\n<li>\n<p>其他</p>\n<ul>\n<li>指示流程的内容按「Step A -> Step B -> Step C」格式书写</li>\n<li>指示代码行号的内容按「LNUM [-ENDNUM]」格式书写</li>\n<li>引用拥有个人主页、博客或 GitHub 账号的人员名称按「@NICKNAME」格式书写</li>\n<li>引用 GitHub 的仓库名称按「@USER/REPO」格式书写</li>\n<li>引用文献的名称按「原标题 - 来源」格式书写并将链接包含在全角书名号之内</li>\n<li>段落中阐述代码用到的「变量名称」「函数名称」等按行内代码块格式书写</li>\n<li>段落中非阐述代码用到的且需要强调的内容使用直角引号包围</li>\n<li>段落中文件名、文件路径、文件名后缀等内容按行内代码块格式书写</li>\n<li>文章正文内各级标题要意义明确、格式一致、保持简洁，不多于两层标题嵌套</li>\n<li>文章中表示个人想法、从别处摘抄的内容按照引用格式书写</li>\n<li>文章直接引用到正文的内容不符合本站规则的地方需要进行适当调整</li>\n<li>文章中引用的、可能存在争议的内容在脚注中进行说明</li>\n</ul>\n</li>\n</ul>\n<p>除去这些规定，在文章的分类和标签上我也相较原来的 Typecho 博客做了些精简。分类目前想法是只保留 <a href=\"https://blog.monsterx.cn/Category/life\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">life</a> <a href=\"https://blog.monsterx.cn/Category/code\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">code</a> <a href=\"https://blog.monsterx.cn/Category/tech\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">tech</a> 三类，分别用来保留筛选后关于「记录生活的手帐、站点杂务」「写代码的探索和思考」「学习某些技术、使用轮子的日志」的内容。每篇文章的标签保持精简，写完整篇文章后提取两到三个关键词作为标签。</p>\n<p>做完这些剩下的就是提升自身水平了……</p>\n<h2 id=\"keep-moving\"><a href=\"#keep-moving\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Keep moving...</h2>\n"}}]}}},"context":{}}