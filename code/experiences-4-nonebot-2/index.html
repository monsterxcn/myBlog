<!DOCTYPE html>
<html data-html-server-rendered="true" lang="zh-Hans" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22zh-Hans%22%7D%7D">
  <head>
    <title>NoneBot 插件编写尝试 - Monstx&#x27;s Blog</title><meta name="gridsome:hash" content="c4f80661f9f365b8b7f933c36160c7dc6820d2f4"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.23"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" name="theme-color" content="#dee1e6"><meta data-vue-tag="ssr" name="apple-mobile-web-app-capable" content="yes"><meta data-vue-tag="ssr" name="apple-mobile-web-app-status-bar-style" content="default"><meta data-vue-tag="ssr" name="apple-mobile-web-app-title" content="Monstx&#x27;s Blog"><meta data-vue-tag="ssr" name="application-name" content="Monstx&#x27;s Blog"><meta data-vue-tag="ssr" name="msapplication-TileColor" content="#fafafa"><meta data-vue-tag="ssr" name="msapplication-TileImage" content="/assets/icons/msapplication-icon-144x144.png"><meta data-vue-tag="ssr" data-key="og:type" property="og:type" content="website"><meta data-vue-tag="ssr" data-key="og:title" property="og:title" content="NoneBot 插件编写尝试"><meta data-vue-tag="ssr" data-key="og:description" property="og:description" content="实在是受不了这种书看不进去无所事事的日子，于是给自己找了事情忙活。"><meta data-vue-tag="ssr" data-key="og:url" property="og:url" content="https://blog.monsterx.cn/code/experiences-4-nonebot-2/"><meta data-vue-tag="ssr" data-key="og:image" property="og:image" content="https://blog.monsterx.cn/screen.png"><meta data-vue-tag="ssr" data-key="twitter:card" name="twitter:card" content="summary_large_image"><meta data-vue-tag="ssr" data-key="twitter:site" name="twitter:site" content="@monsterxcn"><meta data-vue-tag="ssr" data-key="twitter:creator" name="twitter:creator" content="@monsterxcn"><meta data-vue-tag="ssr" data-key="twitter:title" name="twitter:title" content="NoneBot 插件编写尝试"><meta data-vue-tag="ssr" data-key="twitter:description" name="twitter:description" content="实在是受不了这种书看不进去无所事事的日子，于是给自己找了事情忙活。"><meta data-vue-tag="ssr" data-key="twitter:image" name="twitter:image" content="https://blog.monsterx.cn/screen.png"><meta data-vue-tag="ssr" data-key="description" name="description" itemprop="description" content="实在是受不了这种书看不进去无所事事的日子，于是给自己找了事情忙活。"><meta data-vue-tag="ssr" data-key="name" itemprop="name" content="NoneBot 插件编写尝试"><meta data-vue-tag="ssr" data-key="image" itemprop="image" content="https://blog.monsterx.cn/screen.png"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.bf61008f0ef71b874a75ec950abb49a1.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.bf61008f0ef71b874a75ec950abb49a1.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/assets/static/favicon.b9532cc.bf61008f0ef71b874a75ec950abb49a1.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/assets/static/favicon.f22e9f3.bf61008f0ef71b874a75ec950abb49a1.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="152x152" href="/assets/static/favicon.62d22cb.bf61008f0ef71b874a75ec950abb49a1.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="120x120" href="/assets/static/favicon.1539b60.bf61008f0ef71b874a75ec950abb49a1.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="167x167" href="/assets/static/favicon.dc0cdc5.bf61008f0ef71b874a75ec950abb49a1.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="180x180" href="/assets/static/favicon.7b22250.bf61008f0ef71b874a75ec950abb49a1.png"><link data-vue-tag="ssr" rel="manifest" href="/manifest.json"><link data-vue-tag="ssr" rel="mask-icon" href="./src/favicon.svg" color="#fafafa"><link rel="preload" href="/assets/css/styles.df111b13.css" as="style"><link rel="preload" href="/assets/js/app.ca25ae24.js" as="script"><link rel="preload" href="/assets/css/8.styles.ade877ec.css" as="style"><link rel="preload" href="/assets/js/page--src--templates--blog-post-vue.5b922b7e.js" as="script"><link rel="prefetch" href="/assets/css/0.styles.959d94f0.css"><link rel="prefetch" href="/assets/css/10.styles.c4971a30.css"><link rel="prefetch" href="/assets/css/11.styles.260b4624.css"><link rel="prefetch" href="/assets/css/2.styles.2931a0ed.css"><link rel="prefetch" href="/assets/css/3.styles.41d1c847.css"><link rel="prefetch" href="/assets/css/4.styles.6c65bb1e.css"><link rel="prefetch" href="/assets/css/5.styles.aa09ecc1.css"><link rel="prefetch" href="/assets/css/6.styles.e7f158b2.css"><link rel="prefetch" href="/assets/css/7.styles.bd4fcc6c.css"><link rel="prefetch" href="/assets/css/9.styles.c4971a30.css"><link rel="prefetch" href="/assets/js/page--src--pages--404-vue.99cf25ee.js"><link rel="prefetch" href="/assets/js/page--src--pages--about-vue.c220b78c.js"><link rel="prefetch" href="/assets/js/page--src--pages--archives-vue.d739f6f3.js"><link rel="prefetch" href="/assets/js/page--src--pages--friends-vue.b7dbbde1.js"><link rel="prefetch" href="/assets/js/page--src--pages--index-vue.91bdd984.js"><link rel="prefetch" href="/assets/js/page--src--pages--watch-vue.18ad2f83.js"><link rel="prefetch" href="/assets/js/page--src--templates--category-vue.d37e7688.js"><link rel="prefetch" href="/assets/js/page--src--templates--tag-vue.77e47b73.js"><link rel="prefetch" href="/assets/js/vendors~page--src--pages--about-vue~page--src--pages--watch-vue~page--src--templates--blog-post-vue.54fac1eb.js"><link rel="prefetch" href="/assets/js/vendors~page--src--templates--blog-post-vue.9444f5e6.js"><link rel="stylesheet" href="/assets/css/styles.df111b13.css"><link rel="stylesheet" href="/assets/css/8.styles.ade877ec.css"><script data-vue-tag="ssr" type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","description":"实在是受不了这种书看不进去无所事事的日子，于是给自己找了事情忙活。","datePublished":"August 22, 2021","author":{"name":"monsterxcn"},"headline":"NoneBot 插件编写尝试","image":"https://blog.monsterx.cn/screen.png"}</script><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body >
    <script>
      // Add dark / light detection that runs before Vue.js load. Borrowed from overreacted.io
      ;(function () {
        window.__onThemeChange = function () {}
        function setTheme(newTheme) {
          window.__theme = newTheme
          preferredTheme = newTheme
          document.body.setAttribute('data-theme', newTheme)
          window.__onThemeChange(newTheme)
        }

        var preferredTheme
        try {
          preferredTheme = localStorage.getItem('theme')
        } catch (err) {}

        window.__setPreferredTheme = function (newTheme) {
          setTheme(newTheme)
          try {
            localStorage.setItem('theme', newTheme)
          } catch (err) {}
        }

        var darkQuery = window.matchMedia('(prefers-color-scheme: dark)')
        darkQuery.addListener(function (e) {
          window.__setPreferredTheme(e.matches ? 'dark' : 'light')
        })

        setTheme(preferredTheme || (darkQuery.matches ? 'dark' : 'light'))
      })()
    </script>

    <div id="app" data-server-rendered="true"><div id="nprogress-container"><header class="header"><div class="header__left"><div><a href="/" class="logo active"><span class="logo__text">
      ⟁   Monstx's Blog
    </span></a></div></div><div class="header__right"><button role="button" aria-label="Toggle dark/light" class="toggle-theme"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg></button></div></header></div><main class="main"><div><div class="post-title"><h1 class="post-title__text">
      NoneBot 插件编写尝试
      <!----></h1><div class="post-meta">
  August 22, 2021 ·
  
    2794 words ·
    <strong> 9 min read</strong></div></div><div class="post content-box"><div class="post__header"><!----></div><!----><div class="post__content"><p>放假在家本来打算看看考研的书，结果硬是只看进去了一丁点皮毛。实在是受不了这种书看不进去无所事事的日子，于是给自己找了事情忙活。之前一直在用 <a href="https://github.com/Tsuk1ko/cq-picsearcher-bot" target="_blank" rel="nofollow noopener noreferrer">@Tsuk1ko/cq-picsearcher-bot</a>，上半年尝试了解了一些 Telegram bot 的东西还顺手给 PagerMaid 修了一个简单的插件 Bug，最近放假发现了好多好玩的 QQ 机器人项目…… 这些让我想自己写个机器人玩，于是便有了下文。</p>
<h2 id="go-cqhttp-和-nonebot"><a href="#go-cqhttp-%E5%92%8C-nonebot" aria-hidden="true"><span class="icon icon-link"></span></a>go-cqhttp 和 NoneBot</h2>
<p><a href="https://github.com/Mrs4s/go-cqhttp" target="_blank" rel="nofollow noopener noreferrer">@Mrs4s/go-cqhttp</a> 是「使用 mirai 以及 MiraiGo 开发的 cqhttp golang 原生实现」，在酷 Q 倒下之后感觉撑起了 QQ 机器人的半边天，在很多项目中都能看见他。通过 go-cqhttp 的各种 API 接口，开发者能使用 Node.js Python Golang C 等各种编程语言处理机器人收到的信息（Event），做进一步响应。<a href="https://github.com/nonebot/nonebot2" target="_blank" rel="nofollow noopener noreferrer">@nonebot/nonebot2</a> 便是一个能和 go-cqhttp 对接的「跨平台 Python 异步机器人框架」。</p>
<p>看了几遍《<a href="https://v2.nonebot.dev/guide/" target="_blank" rel="nofollow noopener noreferrer">概览 - NoneBot</a>》后，我觉得 NoneBot 是一个很方便的平台，有自己的脚手架可以快速创建项目；它的商店里所有插件都可供学习，Python 实现的机器人也有很多源码可供参考，官方文档没看懂可以找些大佬写的例子看看；上半年有一小阵子折腾 Telegram bot 时看了一些 Python 的代码，了解了最基本的插件是如何工作的。这些经验让我决定了使用 nonebot2。</p>
<p>go-cqhttp 和 nonebot2 的安装和配置均可参考对应文档。最终 nonebot2 的项目文件夹可以通过 <code>nb create</code> 快速创建，nonebot2 通信协议 Adapter 选用官方维护的 <code>nonebot-adapter-cqhttp</code> 即可，使用 <code>nonebot_adapter_gocq</code> 可能会存在兼容性问题。go-cqhttp 的反向 WebSocket Universal 地址需要配置为 <code>http:///[HOST]:[PORT]/cqhttp/ws</code>，其中 <code>[HOST]:[PORT]</code> 和 nonebot2 <code>.env</code> 中的配置保持一致，我尝试填写别的地址时连接不上。先登陆一次 go-cqhttp 生成 data device.json 等文件夹和文件，启动机器人时先使用 <code>nb run</code> 或 <code>python3 bot.py</code> 启动 NoneBot，然后进入 go-cqhttp 文件夹下启动 go-cqhttp。在 NoneBot 输出中看到 <code>WebSocket Connection from CQHTTP Bot NNNNNNNNNN Accepted!</code> 就算成功！</p>
<h2 id="虚拟环境-venv"><a href="#%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83-venv" aria-hidden="true"><span class="icon icon-link"></span></a>虚拟环境 venv</h2>
<p>初次尝试 NoneBot 后我发现通过 <code>pip</code> 安装插件的方式虽然方便，但是很容易出现依赖版本冲突，这时候虚拟环境就显得很重要。这也是我第一次尝试虚拟环境。NoneBot 推荐使用 Poetry，但我用了下不太习惯，尤其是最新版本的 <code>nb-cli</code> 创建的项目文件夹中 <code>pyproject.toml</code> 依赖却是低版本的。最终我还是选择了 <code>venv</code>。</p>
<pre class="language-bash line-numbers"><code class="language-bash"><span class="token comment"># 安装 venv</span>
python3 -m pip <span class="token function">install</span> venv
<span class="token comment"># 在 /path/to/thisvenv 文件夹下创建一个虚拟环境</span>
python3 -m venv /path/to/thisvenv

<span class="token comment"># 进入 /path/to/myBots 文件夹并启用虚拟环境</span>
<span class="token builtin class-name">cd</span> /path/to/myBots
<span class="token builtin class-name">source</span> /path/to/thisvenv
<span class="token comment"># 启用后命令行前会多出当前虚拟环境的名字</span>
<span class="token punctuation">(</span>thisvenv<span class="token punctuation">)</span> user@host: myBots$

<span class="token comment"># 使用 pip 安装各种依赖</span>
<span class="token comment"># pip install -i https://pypi.tuna.tsinghua.edu.cn/simple packagename</span>
pip <span class="token function">install</span> nb-cli nonebot-adapter-cqhttp

nb create
<span class="token builtin class-name">cd</span> abot
<span class="token comment"># ...</span>
nb run

<span class="token comment"># 退出虚拟环境</span>
deactivate<span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>如果创建虚拟环境时使用 <code>python3</code> 那么在虚拟环境中 <code>python</code> 和 <code>pip</code> 也都指向最新版本。在整个项目完成后可以生成当前环境中各种依赖版本：</p>
<pre class="language-bash line-numbers"><code class="language-bash">pip freeze <span class="token operator">></span> requirements.txt    <span class="token comment"># 备份当前的依赖版本</span>

pip <span class="token function">install</span> -r requirements.txt  <span class="token comment"># 安装指定的依赖版本</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span></span></code></pre>
<h2 id="第一个插件"><a href="#%E7%AC%AC%E4%B8%80%E4%B8%AA%E6%8F%92%E4%BB%B6" aria-hidden="true"><span class="icon icon-link"></span></a>第一个插件</h2>
<p>根据《<a href="https://v2.nonebot.dev/guide/creating-a-plugin.html" target="_blank" rel="nofollow noopener noreferrer">创建插件 - NoneBot</a>》的指导并参考众多 NoneBot 插件做法，插件目录一般为 <code>src/plugins</code>，在其中创建一个文件夹或单个文件都可以被 NoneBot 加载为插件。</p>
<p>我的第一个插件是用于获取 Epic Game Store 限时免费游戏的，因为某天打开群时看到有人说 <a href="https://github.com/DIYgod/RSSHub" target="_blank" rel="nofollow noopener noreferrer">@DIYgod/RSSHub</a> 的 Epic <a href="https://docs.rsshub.app/game.html#epic-games-store" target="_blank" rel="nofollow noopener noreferrer">免费游戏</a> 不能用了，我第一感觉就是他懒没有自己部署罢了…… 我自己去部署了一下果然还是好使的。看了看这个路由的 <a href="https://github.com/DIYgod/RSSHub/tree/master/lib/routes/epicgames" target="_blank" rel="nofollow noopener noreferrer">源码</a>，感觉还挺好玩的。于是决定将他改成机器人插件。</p>
<p>这种插件的形式是检测到符合要求的命令之后，向某个网站 API 发起 HTTP 请求，根据返回的信息（一般是 JSON）处理之后返回给用户。机器人的大多数功能都可以通过这种形式写出来，因为网上各种可供调用的 API 实在是太多了，什么搜图、翻译、段子、涩图、天气、查快递都有（好像混入了奇怪的东西）。@DIYgod/RSSHub <code>/epicgames/freegames</code> 路由的实现方法特别之处是向 Epic 的 GraphQL 服务器发起 <code>query</code> 查询请求，我见得少觉得很新颖。</p>
<p>NoneBot 最大的特点就是「异步」，所以发起 HTTP 请求的方式不推荐用 <code>requests</code>，自带的 <code>httpx</code> 或者 <code>aiohttp</code> 都是很合适的异步网络请求工具，这里给出改写后的 <code>httpx</code> 实现。</p>
<pre class="language-python line-numbers"><code class="language-python"><span class="token comment"># async 定义一个异步函数，NoneBot 中插件的函数大都以此定义</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">get_Epicgame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token comment"># 发起请求的地址</span>
  epic_url <span class="token operator">=</span> <span class="token string">"https://www.epicgames.com/store/backend/graphql-proxy"</span>
  <span class="token comment"># HTTP 请求的 Headers</span>
  headers <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">"Referer"</span><span class="token punctuation">:</span> <span class="token string">"https://www.epicgames.com/store/zh-CN/"</span><span class="token punctuation">,</span>
    <span class="token string">"Content-Type"</span><span class="token punctuation">:</span> <span class="token string">"application/json; charset=utf-8"</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token comment"># 要发送的 JSON 数据包，query 部分不完整</span>
  data <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"query searchStoreQuery($allowCountries: String, ... "</span><span class="token punctuation">,</span>
    <span class="token string">"variables"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token string">"allowCountries"</span><span class="token punctuation">:</span> <span class="token string">"CN"</span><span class="token punctuation">,</span>
      <span class="token string">"category"</span><span class="token punctuation">:</span> <span class="token string">"freegames"</span><span class="token punctuation">,</span>
      <span class="token string">"count"</span><span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
      <span class="token string">"country"</span><span class="token punctuation">:</span> <span class="token string">"CN"</span><span class="token punctuation">,</span>
      <span class="token string">"locale"</span><span class="token punctuation">:</span> <span class="token string">"zh-CN"</span><span class="token punctuation">,</span>
      <span class="token string">"sortBy"</span><span class="token punctuation">:</span> <span class="token string">"effectiveDate"</span><span class="token punctuation">,</span>
      <span class="token string">"sortDir"</span><span class="token punctuation">:</span> <span class="token string">"asc"</span><span class="token punctuation">,</span>
      <span class="token string">"withPrice"</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
      <span class="token string">"withPromotions"</span><span class="token punctuation">:</span> <span class="token boolean">True</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment"># 使用异步 API 创建 Client，HTTP Headers 可以在此传递</span>
  <span class="token keyword">async</span> <span class="token keyword">with</span> AsyncClient<span class="token punctuation">(</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span> <span class="token keyword">as</span> client<span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
      <span class="token comment"># 通过 json=data 的方式传递上面定义的 JSON 数据，发起 POST 请求</span>
      res <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span>post<span class="token punctuation">(</span>epic_url<span class="token punctuation">,</span> json<span class="token operator">=</span>data<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">10.0</span><span class="token punctuation">)</span>
      <span class="token comment"># res 为获取到的数据，通过 .json() 转为 JSON 数据</span>
      resJson <span class="token operator">=</span> res<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token comment"># 简单的挑选响应结果中有用的部分</span>
      games <span class="token operator">=</span> resJson<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'Catalog'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'searchStore'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'elements'</span><span class="token punctuation">]</span>
      <span class="token keyword">return</span> games
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
      logger<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token boolean">None</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这样一个简单的能执行 HTTP 异步请求的函数就写好了，在调用异步函数的地方使用类似 <code>res = await asyncFunctionName()</code> 的语句。为了测试这一函数是否可用，我通常会将其单独拎出来，放在下面这样的文件中单独执行测试。</p>
<pre class="language-python line-numbers"><code class="language-python"><span class="token keyword">import</span> asyncio
<span class="token keyword">import</span> httpx

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token comment"># ...</span>
  <span class="token keyword">async</span> <span class="token keyword">with</span> httpx<span class="token punctuation">.</span>AsyncClient<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> client<span class="token punctuation">:</span>
    response <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://www.example.com/'</span><span class="token punctuation">)</span>
    <span class="token comment"># ...</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>     <span class="token comment"># return 改为 print</span>

asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>像这种获取数据供插件使用的函数 NoneBot 推荐写在插件文件夹下 <code>data_source.py</code> 里。在其他需要的地方通过 <code>import</code> 导入。关于 <code>httpx</code> 的更多操作可以在《<a href="https://www.python-httpx.org/quickstart/" target="_blank" rel="nofollow noopener noreferrer">QuickStart - HTTPX</a>》中查找，现学现卖完全够用。</p>
<p>回到此插件，获取到 HTTP 响应的数据之后还需要挑选其中有用的部分，我这里获取的 JSON 数据包含了拥有折扣的众多游戏信息，为了挑选出其中的限免游戏我写了另外一个函数 <code>get_Epicfree()</code> 放在 <code>data_source.py</code> 里。这里讲个插曲，写完获取数据的函数后我才发现 python 原来已经有写好的包可以直接用 <a href="https://github.com/SD4RK/epicstore_api" target="_blank" rel="nofollow noopener noreferrer">SD4RK/epicstore_api</a>，而且这个包里给出了更多 <code>query</code> 查询语句，并且免费游戏的例子他也写出来了。好家伙，处理 JSON 数据的逻辑我直接照搬，省下了大把功夫。</p>
<p>这样 <code>data_source.py</code> 的大部分功能就完成了，接下来新建 <code>__init__.py</code> 文件，这里将告诉机器人插件何时响应用户，如何响应用户。</p>
<pre class="language-python line-numbers"><code class="language-python"><span class="token keyword">from</span> nonebot <span class="token keyword">import</span> on_regex
<span class="token keyword">from</span> nonebot<span class="token punctuation">.</span>typing <span class="token keyword">import</span> T_State
<span class="token keyword">from</span> nonebot<span class="token punctuation">.</span>adapters<span class="token punctuation">.</span>cqhttp <span class="token keyword">import</span> Bot<span class="token punctuation">,</span> Event<span class="token punctuation">,</span> Message

<span class="token comment"># 导入 .data_source 里需要用到的函数</span>
<span class="token keyword">from</span> <span class="token punctuation">.</span>data_source <span class="token keyword">import</span> get_Epicfree

<span class="token comment"># 注册了一个事件响应器 matcher，这里只要符合正则就响应</span>
matcher <span class="token operator">=</span> on_regex<span class="token punctuation">(</span><span class="token string">"((E|e)(P|p)(I|i)(C|c))?喜(加一|\+1)"</span><span class="token punctuation">,</span> priority<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment"># 事件响应器 matcher 的事件处理函数</span>
<span class="token decorator annotation punctuation">@matcher<span class="token punctuation">.</span>handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">handle</span><span class="token punctuation">(</span>bot<span class="token punctuation">:</span> Bot<span class="token punctuation">,</span> event<span class="token punctuation">:</span> Event<span class="token punctuation">,</span> state<span class="token punctuation">:</span> T_State<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token comment"># 异步调用 data_source 里的函数</span>
  <span class="token comment"># 我的 get_Epicfree 里调用了发起 HTTP 请求的 get_Epicgame 并处理出最终的消息文本</span>
  imfree <span class="token operator">=</span> <span class="token keyword">await</span> get_Epicfree<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment"># 有的时候需要使用 Message() 将对象转换为可用的消息对象</span>
  msg <span class="token operator">=</span> Message<span class="token punctuation">(</span>imfree<span class="token punctuation">)</span>
  <span class="token comment"># 事件响应器的 finish() 结束事件响应，此外还有 send() 等可用</span>
  <span class="token keyword">await</span> matcher<span class="token punctuation">.</span>finish<span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>如此，一个最基本的插件就做好了。重新启动 NoneBot 后启用此插件。关于这个插件的所有代码均可在仓库 <a href="https://github.com/monsterxcn/nonebot_plugin_epicfree" target="_blank" rel="nofollow noopener noreferrer">@monsterxcn/nonebot_plugin_epicfree</a> 查看。你也可以通过 <code>nb</code> 或 <code>pip</code> 安装 <code>nonebot_plugin_epicfree</code> 体验。</p>
<h2 id="pillow-画图插件"><a href="#pillow-%E7%94%BB%E5%9B%BE%E6%8F%92%E4%BB%B6" aria-hidden="true"><span class="icon icon-link"></span></a>Pillow 画图插件</h2>
<p>很多时候咱有发图片的需求，比如「无内鬼，搞点…」什么的，其中图片除了像第一个插件一样通过请求 API 返回图片的 URL，有的时候可能还需要添加一些细节。比如 <a href="https://github.com/Xtao-Labs/PagerMaid_Plugins" target="_blank" rel="nofollow noopener noreferrer">@Xtao-Labs/PagerMaid_Plugins</a> Telegram 人形自走机器人插件仓库中的吃 / 丢用户头像功能，需要获取用户的头像然后自行拼接到背景图片上；又比如我想做一个原神每日素材的功能，事先准备好了各种素材对应角色或武器的图片，希望机器人来处理拼接这些图片成为当日素材。</p>
<p>这里就以原神每日素材的功能需求为例，交代我的实现方法。@Xtao-Labs/PagerMaid_Plugins 中的功能可以作为进阶操作，我自己也照着原仓库代码改写出来了，但是代码理解的不够深，就不拿出来献丑了，说不定什么时候没人我就悄咪咪传到 Gist 存个档留念。</p>
<p>各种素材图片来源于 <a href="https://genshin.pub/daily" target="_blank" rel="nofollow noopener noreferrer">今日素材表 - 可莉特调</a>，我通过 Chrome 开发者工具中 <code>Ctrl</code> <code>Shift</code> <code>P</code> 调用 <code>[Screenshot] Capture node screenshot</code> 手动获取，算是个笨办法了。将每种素材对应截取一张图片，3 个区域 18 种素材 18 张图片，分别命名成 <code>{区域名}.{星期数}.png</code> 的格式。我还另外截取了「今日素材可升天赋角色」「今日素材可突破武器」两张头图，命名为 <code>header.png</code>。</p>
<p>接下来编写 <code>getMaterial(type)</code> 函数用来获取包含了 <code>type</code> 对应头图和蒙德、璃月、稻妻三个区域 <code>type</code> 对应素材图片的 <code>Image</code> 类型列表，函数内调用 <code>datetime</code> 库获取当日星期数。<code>Image</code> 类型是 Python 绘图库 <code>Pillow</code> 内定义的，他包含了图片的色彩模式、像素大小等信息，使用 <code>image.open(filename)</code> 或者 <code>Image.new()</code> 均可得到一个 Image 类型的对象。</p>
<pre class="language-python line-numbers"><code class="language-python"><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">getMaterial</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  day <span class="token operator">=</span> datetime<span class="token punctuation">.</span>today<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>weekday<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>    <span class="token comment"># 星期一对应 1，星期日对应 7</span>
  imgList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>                            <span class="token comment"># 存放 Image 类型数据的列表，默认为空</span>
  filename <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">type</span><span class="token punctuation">}</span></span><span class="token string">.</span><span class="token interpolation"><span class="token punctuation">{</span>day<span class="token punctuation">}</span></span><span class="token string">.png'</span></span>          <span class="token comment"># 供后续调用，是将要生成的图片名</span>
  width<span class="token punctuation">,</span> height <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>                  <span class="token comment"># 供后续调用，是将要生成的图片大小，默认为 0</span>
  <span class="token keyword">if</span> day <span class="token operator">!=</span> <span class="token number">7</span><span class="token punctuation">:</span>
    daily <span class="token operator">=</span> day <span class="token keyword">if</span> day <span class="token operator">&lt;</span> <span class="token number">4</span> <span class="token keyword">else</span> day <span class="token operator">-</span> <span class="token number">3</span>   <span class="token comment"># 周四周五周六素材分别于周一周二周三相同</span>
    countries <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Mondstadt"</span><span class="token punctuation">,</span> <span class="token string">"Liyue"</span><span class="token punctuation">,</span> <span class="token string">"Inazuma"</span><span class="token punctuation">]</span>
    <span class="token comment"># 通过 append() 将 Image.open() 获取的 Image 类型数据加入列表</span>
    imgList<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>resPath <span class="token operator">+</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">type</span><span class="token punctuation">}</span></span><span class="token string">/header.png"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 头图</span>
    <span class="token keyword">for</span> country <span class="token keyword">in</span> countries<span class="token punctuation">:</span>
      <span class="token comment"># 遍历三个区域，取出所需 type 的素材分图</span>
      image <span class="token operator">=</span> resPath <span class="token operator">+</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">type</span><span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{</span>country<span class="token punctuation">}</span></span><span class="token string">.</span><span class="token interpolation"><span class="token punctuation">{</span>daily<span class="token punctuation">}</span></span><span class="token string">.png"</span></span>
      imgList<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># 遍历生成的 Image 类型数据列表，获取即将生成的图片总高度、总宽度</span>
    <span class="token keyword">for</span> img <span class="token keyword">in</span> imgList<span class="token punctuation">:</span>
      w<span class="token punctuation">,</span> h <span class="token operator">=</span> img<span class="token punctuation">.</span>size
      height <span class="token operator">+=</span> h              <span class="token comment"># 高度累加，后续我将图片列表的 Image 从上到下拼接</span>
      width <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> w<span class="token punctuation">)</span>    <span class="token comment"># 宽度为最大的宽度，实际我的图片宽度都一样</span>
  <span class="token keyword">return</span> imgList<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> filename<span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>好，这个函数将返回包含待处理图片的 Image 类型列表、预计生成图片的宽度和高度、待生成的图片名。如果时间为周日则返回一个空的列表，后续可以判断列表是否为空决定最终返回的消息。因为周日所有素材均可获取。接下来编写画图的函数，这部分可能需要结合《<a href="https://pillow.readthedocs.io/en/stable/" target="_blank" rel="nofollow noopener noreferrer">Pillow - Pliiow (PIL Fork) Documentation</a>》相关函数的说明理解。不过此例还算简单了，基本只用到了一个粘贴的函数 <code>Image.paste()</code>，如果要实现前面所说的吃头像功能还要到文档里学习更多。</p>
<pre class="language-python line-numbers"><code class="language-python"><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">msgTranslate</span><span class="token punctuation">(</span>imgList<span class="token punctuation">,</span> totalWidth<span class="token punctuation">,</span> totalHeight<span class="token punctuation">,</span> saveAs<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">if</span> imgList <span class="token operator">==</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">"哈！今天是周日，所有天赋秘境和武器秘境全部开放哦🥰"</span>
  <span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token comment"># 新建一个 Image 对象，颜色制式与 imgList[0] 一样，背景颜色为纯色 #F6F2EE</span>
    result <span class="token operator">=</span> Image<span class="token punctuation">.</span>new<span class="token punctuation">(</span>imgList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mode<span class="token punctuation">,</span> <span class="token punctuation">(</span>totalWidth<span class="token punctuation">,</span> totalHeight<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"#F6F2EE"</span><span class="token punctuation">)</span>
    drawFromHeight <span class="token operator">=</span> <span class="token number">0</span>        <span class="token comment"># 初始绘制时的动作点高度</span>
    <span class="token keyword">for</span> img <span class="token keyword">in</span> imgList<span class="token punctuation">:</span>
      w<span class="token punctuation">,</span> h <span class="token operator">=</span> img<span class="token punctuation">.</span>size         <span class="token comment"># 获取当前图片的宽度、高度</span>
      <span class="token comment"># 向 result 这个 Image 中粘贴 img，box 的参数是粘贴图片的左上角坐标</span>
      result<span class="token punctuation">.</span>paste<span class="token punctuation">(</span>img<span class="token punctuation">,</span> box<span class="token operator">=</span><span class="token punctuation">(</span><span class="token builtin">round</span><span class="token punctuation">(</span>totalWidth <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> w <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> drawFromHeight<span class="token punctuation">)</span><span class="token punctuation">)</span>
      drawFromHeight <span class="token operator">+=</span> h     <span class="token comment"># 一张图片粘贴完后累加高度</span>
    result<span class="token punctuation">.</span>save<span class="token punctuation">(</span>saveAs<span class="token punctuation">)</span>       <span class="token comment"># 将 Image 对象 result 保存为文件 saveAs，注意要带上完整路径</span>
    msg <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"[CQ:image,file=file://</span><span class="token interpolation"><span class="token punctuation">{</span>saveAs<span class="token punctuation">}</span></span><span class="token string">]"</span></span>
    <span class="token keyword">return</span> msg<span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>如此，图片就绘制好了，<code>result</code> 是一个 Image 类型数据，并不能直接通过 NoneBot 发送。使用 <code>result.save("/path/to/.png")</code> 可以将其生成为一张图片，这样使用 CQ 码 <code>[CQ:image,file=file:///path/to/.png]</code> 就可以发送出去了。</p>
<p>最后是事件响应器，我在 <code>__init__.py</code> 中使用了如下逻辑：</p>
<pre class="language-python line-numbers"><code class="language-python">materialMatch <span class="token operator">=</span> on_command<span class="token punctuation">(</span><span class="token string">'今天打什么'</span><span class="token punctuation">,</span> priority<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@materialMatch<span class="token punctuation">.</span>handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">send_mt</span><span class="token punctuation">(</span>bot<span class="token punctuation">:</span> Bot<span class="token punctuation">,</span> event<span class="token punctuation">:</span> GroupMessageEvent<span class="token punctuation">,</span> state<span class="token punctuation">:</span> T_State<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token comment"># 获取消息。比如发送了「今天打什么天赋」后 bot 会获取到 searchFor='天赋'</span>
  searchFor <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>get_message<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> searchFor <span class="token operator">==</span> <span class="token string">'天赋'</span> <span class="token keyword">or</span> searchFor <span class="token operator">==</span> <span class="token string">'武器'</span><span class="token punctuation">:</span>
    <span class="token builtin">type</span> <span class="token operator">=</span> <span class="token string">'talent'</span> <span class="token keyword">if</span> searchFor <span class="token operator">==</span> <span class="token string">'天赋'</span> <span class="token keyword">else</span> <span class="token string">'weapon'</span>
    <span class="token comment"># 调用刚才编写的两个函数</span>
    material <span class="token operator">=</span> <span class="token keyword">await</span> getMaterial<span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">)</span>
    msg <span class="token operator">=</span> <span class="token keyword">await</span> msgTranslate<span class="token punctuation">(</span>material<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> material<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> material<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> material<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment"># 发送消息，也可以先将图片转为 Base64 编码再发送</span>
    <span class="token keyword">await</span> materialMatch<span class="token punctuation">.</span>finish<span class="token punctuation">(</span>Message<span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token comment"># 没有检测到要打什么</span>
    <span class="token keyword">await</span> materialMatch<span class="token punctuation">.</span>finish<span class="token punctuation">(</span>Message<span class="token punctuation">(</span><span class="token string">"打什么？[CQ:face,id=32]"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> at_sender<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>当然以上这些只是大概讲了下我做这个功能的思路，还有一些细节可以优化优化，比如：这里只简单判断了星期数，没有判断时间是否过了凌晨 4 点；图像是每次使用时都重新生成，也没有做缓存。完整的代码我可能什么时候觉得整理得差不多了再放到 GitHub。</p>
<h2 id="heu-定时打卡插件"><a href="#heu-%E5%AE%9A%E6%97%B6%E6%89%93%E5%8D%A1%E6%8F%92%E4%BB%B6" aria-hidden="true"><span class="icon icon-link"></span></a>HEU 定时打卡插件</h2>
<p>写了两个插件之后我觉得自己还蛮厉害的，于是开始想办法将之前做的学校疫情打卡实现到机器人上。最近疫情有所反弹，学校又开始了返校前的打卡活动。另外大家都要注意防疫哦。</p>
<p>打卡的插件原本是需要自己获取 <code>formData</code> <code>boundFields</code> 等参数的，还要处理 HEU CAS 认证的相关 Cookies 等，如何使用 <code>httpx</code> 实现这些功能我还不太理解，于是妥协以模拟浏览器操作的方式实现。这里使用了 <a href="https://github.com/microsoft/playwright-python" target="_blank" rel="nofollow noopener noreferrer">@microsoft/playwright-python</a>，它是个不错的自动化测试工具。通过 <code>pip</code> 安装好 <code>playwright</code> 后，还需要执行一次 <code>playwright install</code> 让 <code>playwright</code> 安装可用的浏览器组件及 <code>ffmpeg</code>。我本来以为国内服务器上安装 <code>chromium</code> 可能会卡住，不过实际用阿里云北京的服务器试了一下并没出现网络问题。</p>
<p>与前述步骤一样，最好的参考文档仍然是《<a href="https://playwright.dev/python/docs/intro" target="_blank" rel="nofollow noopener noreferrer">Getting Started - Playwright Python</a>》。实现打卡部分的代码我已经放在了 Gist <a href="https://gist.github.com/monsterxcn/f0a7a083ee65d52b1400596ace43687b#file-nonebot_plugin_checkin-py-L53-L98" target="_blank" rel="nofollow noopener noreferrer">@monsterxcn/nonebot_plugin_checkin.py</a> L53-98。感觉结合文档比较容易理解，看函数名也容易理解是什么作用，总之 Playwright 是很好上手的。</p>
<p>接下来是定时任务的实现，这需要安装 NoneBot APScheduler 定时任务插件 <a href="https://github.com/nonebot/plugin-apscheduler" target="_blank" rel="nofollow noopener noreferrer">@nonebot/plugin-apscheduler</a>，参考仓库里的「使用方法」即可。在 <code>__init__.py</code> 中定义定时任务，比如实现定时打卡的功能可以这么写：</p>
<pre class="language-python line-numbers"><code class="language-python">scheduler <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">"nonebot_plugin_apscheduler"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>scheduler
<span class="token decorator annotation punctuation">@scheduler<span class="token punctuation">.</span>scheduled_job</span><span class="token punctuation">(</span><span class="token string">"cron"</span><span class="token punctuation">,</span> hour<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span> minute<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span> second<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">auto_checkin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token comment"># 获取 bot 信息</span>
  <span class="token punctuation">(</span>bot<span class="token punctuation">,</span><span class="token punctuation">)</span> <span class="token operator">=</span> nonebot<span class="token punctuation">.</span>get_bots<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span> customer <span class="token keyword">in</span> customers<span class="token punctuation">:</span>
    <span class="token comment"># 拼接 CQ 码 at 某人</span>
    msg <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"[CQ:at,qq=</span><span class="token interpolation"><span class="token punctuation">{</span>customer<span class="token punctuation">}</span></span><span class="token string">] "</span></span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
      <span class="token comment"># 传入了最后一个参数 mode=auto，打卡任务将不输出执行过程提示</span>
      msg <span class="token operator">+=</span> <span class="token keyword">await</span> checkin<span class="token punctuation">(</span>customers<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>customer<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> customers<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>customer<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'auto'</span><span class="token punctuation">)</span>
      <span class="token keyword">await</span> bot<span class="token punctuation">.</span>send_group_msg<span class="token punctuation">(</span>group_id<span class="token operator">=</span>GROUPNUMBER<span class="token punctuation">,</span> message<span class="token operator">=</span>Message<span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
      logger<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token comment"># 如果定时任务执行出错了将向管理员用户私信报错信息</span>
      <span class="token keyword">await</span> bot<span class="token punctuation">.</span>send_private_msg<span class="token punctuation">(</span>user_id<span class="token operator">=</span>ADMIN<span class="token punctuation">,</span> message<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>customer<span class="token punctuation">}</span></span><span class="token string">(学号</span><span class="token interpolation"><span class="token punctuation">{</span>customers<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>customer<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">) 今日打卡定时任务执行出错了！"</span></span><span class="token punctuation">)</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这里值得注意的是在定时任务事件处理函数中如何调用机器人主动发送消息，这种方法在其他场合应该也是通用的。首先通过 L5 获取 <code>bot</code> 对象，然后通过 <code>_ApiCall</code> 方式调用 go-cqhttp API，比如 L12 L16 分别调用了发送群消息、发送私聊消息的接口。</p>
<p>通过此插件主要学习了 Playwright Python 的使用和定时任务的添加。完整插件的代码可以通过前面的 Gist 链接查看。如果有时间我觉得还可以添加上 JSON 操作：将学号密码写入 JSON，执行时读入，判断不存在后令用户输入并写入 JSON。</p>
<h2 id="连续对话的抽签插件"><a href="#%E8%BF%9E%E7%BB%AD%E5%AF%B9%E8%AF%9D%E7%9A%84%E6%8A%BD%E7%AD%BE%E6%8F%92%E4%BB%B6" aria-hidden="true"><span class="icon icon-link"></span></a>连续对话的抽签插件</h2>
<p>做原神每日素材插件的时候，我就想整一个像可莉特调那样的原神黄历、抽签功能。撸完了定时打卡的插件之后我又看了看 Playwright 文档，发现它不仅能用来模拟浏览器操作执行打卡，还带有 <code>screenshot()</code> 函数可以实现网页截图，<code>inner_text()</code> <code>inner_html()</code> 函数可以用来做爬虫。我一拍脑袋，想法有了：通过 Playwright 写一个爬虫爬取诸葛神算测字三百八十四爻（也就是可莉特调使用的运势签），再通过 <code>screenshot()</code> 截取指定选择器的网页截图（使用 Pillow 绘制的话感觉会很麻烦）。写这部分代码参考了群友的机器人 <a href="https://github.com/FYWinds/takker" target="_blank" rel="nofollow noopener noreferrer">@FYWinds/takker</a> 和 Playwright 文档。</p>
<p>爬虫的编写不在此讲解，思路其实很简单，代码见 Gist <a href="https://gist.github.com/monsterxcn/47681a6db630887d69946cc7f0faa0e6" target="_blank" rel="nofollow noopener noreferrer">@monsterxcn/chims-crawler.py</a>。爬到的三百八十四签我也都顺便放在了这个 Gist 里，可以直接拿来用。至于为什么不用网上大把的抽签接口，我是觉得既然决定要折腾，那不如就折腾到底。</p>
<p>Playwright 网页截图也很好实现，与上面插件类似，在打开网页后使用下面这样的语句即可：</p>
<pre class="language-python line-numbers"><code class="language-python"><span class="token keyword">async</span> <span class="token keyword">with</span> async_playwright<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> p<span class="token punctuation">:</span>
  browser <span class="token operator">=</span> <span class="token keyword">await</span> p<span class="token punctuation">.</span>chromium<span class="token punctuation">.</span>launch<span class="token punctuation">(</span><span class="token punctuation">)</span>
  page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span>new_page<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment"># 这里打开的本地 html 文件是接下来我要做的抽签模板文件</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"file://</span><span class="token interpolation"><span class="token punctuation">{</span>resPath<span class="token punctuation">}</span></span><span class="token string">card/tmp.html"</span></span><span class="token punctuation">)</span>
  <span class="token comment"># 设置网页窗口大小</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span>set_viewport_size<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"width"</span><span class="token punctuation">:</span> <span class="token number">1920</span><span class="token punctuation">,</span> <span class="token string">"height"</span><span class="token punctuation">:</span> <span class="token number">1080</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment"># 等待指定选择器加载</span>
  chim <span class="token operator">=</span> <span class="token keyword">await</span> page<span class="token punctuation">.</span>query_selector<span class="token punctuation">(</span><span class="token string">".container"</span><span class="token punctuation">)</span>
  <span class="token keyword">assert</span> chim <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span>
  <span class="token comment"># 截图到路径 {resPath}card/ 文件夹下 tmp.png</span>
  <span class="token keyword">await</span> chim<span class="token punctuation">.</span>screenshot<span class="token punctuation">(</span>path<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>resPath<span class="token punctuation">}</span></span><span class="token string">card/tmp.png"</span></span><span class="token punctuation">)</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>那么如何实现抽签功能呢？我的思路是使用随机数 <code>random.randint(1, 384)</code> 生成签号，然后读取 JSON 文件取出对应签号的签的信息。接下来打开事先编写好的卡片 HTML 模板，使用 <code>replace("模板中的占位符", "签的信息")</code> 替换并保存一个临时文件。执行 Playwright 指定选择器的网页截图。</p>
<p>卡片 HTML 模板我已经放在了 <a href="https://gist.github.com/monsterxcn/d933cafcdc6662c6bdcbd561fe921e8c" target="_blank" rel="nofollow noopener noreferrer">Gist</a>，样式参考可莉特调做了一些调整，字体使用原神游戏客户端的文件即可，路径如下：</p>
<pre class="language-text line-numbers"><code class="language-text">Genshin Impact\Genshin Impact Game\YuanShen_Data\StreamingAssets\MiHoYoSDKRes\HttpServerResources\font<span class="line-numbers-rows" aria-hidden="true"><span></span></span></code></pre>
<p>读取 <code>.json</code> 使用了自带的 <code>json</code> 库，我将卡片模板分别命名为抽签 <code>chim.html</code> 和解签 <code>intp.html</code>。生成图片时调用的是同一个函数，通过参数决定使用哪一个模板。由于无论是之前生成的随机数还是 json 文件中的签号均是阿拉伯数字，写入模板时，还需要一个将阿拉伯数字转换为中文繁体数字的函数，这个算是小细节。代码不难，我就不放在这里占用篇幅了。</p>
<p>这个插件最后一个点是如何连续对话：发送抽签命令后机器人发出了一张图片，接下来应该询问是否需要解签，根据用户回答决定整个流程是否结束。这里用到的是《<a href="https://v2.nonebot.dev/2.0.0a7/api/matcher.html#classmethod-got-key-prompt-none-args-parser-none" target="_blank" rel="nofollow noopener noreferrer">Nonebot.matcher 模块 - NoneBot</a>》的 <code>got()</code> 函数，文档里介绍得不多，我学得也比较蒙，但是最后写出来还是能用的：</p>
<pre class="language-python line-numbers"><code class="language-python"><span class="token comment"># __init__.py</span>

chimMatch <span class="token operator">=</span> on_command<span class="token punctuation">(</span><span class="token string">'抽签'</span><span class="token punctuation">,</span> priority<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@chimMatch<span class="token punctuation">.</span>handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">chim</span><span class="token punctuation">(</span>bot<span class="token punctuation">:</span> Bot<span class="token punctuation">,</span> event<span class="token punctuation">:</span> GroupMessageEvent<span class="token punctuation">,</span> state<span class="token punctuation">:</span> T_State<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">try</span><span class="token punctuation">:</span>
    <span class="token comment"># getChim 函数用来生成随机数并读取 JSON 输出签号、吉凶、签诗、解签</span>
    <span class="token comment"># 将其赋值进 state[] 可以在下面 got() 中继续调用，chimNum 这些都是自己定义的</span>
    state<span class="token punctuation">[</span><span class="token string">"chimNum"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> state<span class="token punctuation">[</span><span class="token string">"chimLuck"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> state<span class="token punctuation">[</span><span class="token string">"chimPoem"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> state<span class="token punctuation">[</span><span class="token string">"chimIntp"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> getChim<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># genrChimImg 函数用来读取模板并替换占位符为签的内容，最后一个参数用来决定使用哪个 HTML 模板</span>
    chimImg <span class="token operator">=</span> <span class="token keyword">await</span> genrChimImg<span class="token punctuation">(</span>state<span class="token punctuation">[</span><span class="token string">"chimNum"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> state<span class="token punctuation">[</span><span class="token string">"chimLuck"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> state<span class="token punctuation">[</span><span class="token string">"chimPoem"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"poem"</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> chimMatch<span class="token punctuation">.</span>send<span class="token punctuation">(</span>Message<span class="token punctuation">(</span>chimImg<span class="token punctuation">)</span><span class="token punctuation">,</span> at_sender<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
  <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
    logger<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> chimMatch<span class="token punctuation">.</span>finish<span class="token punctuation">(</span><span class="token string">"抽签发生了错误🤕"</span><span class="token punctuation">)</span>

<span class="token comment"># got() 指示当 action 不存在时发送 prompt 消息并接收用户新的一条消息</span>
<span class="token decorator annotation punctuation">@chimMatch<span class="token punctuation">.</span>got</span><span class="token punctuation">(</span><span class="token string">'action'</span><span class="token punctuation">,</span> prompt<span class="token operator">=</span><span class="token string">'你需要解签吗？'</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">_</span><span class="token punctuation">(</span>bot<span class="token punctuation">:</span> Bot<span class="token punctuation">,</span> event<span class="token punctuation">:</span> GroupMessageEvent<span class="token punctuation">,</span> state<span class="token punctuation">:</span> T_State<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">if</span> <span class="token string">"不"</span> <span class="token keyword">in</span> state<span class="token punctuation">[</span><span class="token string">'action'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token comment"># 用户说了包含「不」得句子就判定为不需要解签，结束流程</span>
    <span class="token keyword">await</span> chimMatch<span class="token punctuation">.</span>finish<span class="token punctuation">(</span><span class="token string">"好吧"</span><span class="token punctuation">)</span>
  <span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
      <span class="token comment"># 从 state[] 读取签的信息，这样不用重新读 JSON，传入最后一个参数用来决定使用解签的 HTML 模板</span>
      intpImg <span class="token operator">=</span> <span class="token keyword">await</span> genrChimImg<span class="token punctuation">(</span>state<span class="token punctuation">[</span><span class="token string">"chimNum"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> state<span class="token punctuation">[</span><span class="token string">"chimLuck"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> state<span class="token punctuation">[</span><span class="token string">"chimIntp"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"intp"</span><span class="token punctuation">)</span>
      <span class="token keyword">await</span> chimMatch<span class="token punctuation">.</span>finish<span class="token punctuation">(</span>Message<span class="token punctuation">(</span>intpImg<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
      logger<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token comment"># await chimMatch.finish("解签发生了错误🤕")</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>好啦，这个能连续对话、实现抽签解签功能的插件就做好了！主要学习了 NoneBot <code>matcher.got()</code> 和 Playwright <code>page.screenshot()</code>，前者让机器人能从后续对话中获取变量决定程序走向，后者能在 Pillow 绘图较复杂不易实现时提供替代方案。</p>
<hr>
<p><figure><img class="g-image g-image--lazy g-image--loading" src="data:image/svg+xml,%3csvg fill='none' viewBox='0 0 2560 1702' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-0592dc1342fd4de13a6f33a46732e1c0'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-0592dc1342fd4de13a6f33a46732e1c0)' width='2560' height='1702' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAArCAIAAABHOBkQAAAACXBIWXMAAA7DAAAOwwHHb6hkAAANZ0lEQVRo3tVZ628c133lH1I0CNAPjfslCNzAbZCiaZwHGqBogCRuUBSFm6B1UzcfCiNACzQIaiRO0qZOqthKJUNOKlm2VKdqbdmWIlIUxeWSy93lY5e7XC65r9nhPmZn5z33Mc%2bcO8OlVhRJNC2qqBcXw%2bVweef3POfcOzPxLzI45/SBoarqeDx2HIeygDCfMiZmMoIgiP%2bPx8z/3gHbti3LgtWx3YmsVkQcn9jwAeP/hwOwlTNq0mCrfnu9fvNO295RTNMwRiM1iqJH1AE2KRIMh9DYJ2/J/Fdvxx/KxO%2bfjz9XiGzbMXQjCMNfrgN4fPSgA4QSlI3ruiQZ%2bOFRIpv09Q5/o80vtr3MgAVcdMIvuYSCZE47wV3dV7YdSx8MFFjuTQbjuPjIQzrDSaE9DAeowI2jE2DCqB8P5kJt3bPcANF2qQi0Y/BhE/FWlFGv1zNNs9/vDwZDS1e41XMpd1wXFeUSmiTqoTjgEM9xk0num7brnd2o/m1Bem6NXpO8MWKujDmHe6I49GSgkOCDbpiOrXlkhGaG3Zyzwy55GA64JCAUZgUu8dIJ6xFs0/X%2bpBh/dDF44i7/%2b4oXc98RpX4IPAz9wNIfnAUec1nMpffc7lt9xXRNjTgOfAt/wSaGw/y4gUih2bjncy9EtaY304fPUBeI5451i/oRC2OX%2bYc%2b2C5XLG9owW7xK%2b7Tg9IQvZt6gmqJOX254X8%2bH3256H4x5/5xPvhmLdA0faSM4EB0ygiDKPTDZKQ30EmHK08PxAKQAVOJIRHHpA7qlMIR/GmGySXDtLbWKtVCpVbcltt9LwhRKtwLPC8IfDHxGY3huvgH1MW9OsHDHJdEjJxreH9UCL%2b8ET29Lub36r7HKJ2C2umBftI0DRhAuU94DM6zCSP0tCFW4gEdN1jrtWqvVxmgaO1BfwADZhghI0l54uNfeOyZv/y1P/2zp774bBwcwz6%2bH6JPKHE8q%2bdYpizvI63IuOf7CFvAiE/dkFFMtH/EKTvVoMT6gI6qvHfTs7TANmCGm/Z%2bkuHj/gUrM9kOPpENP3w3XBsxaugI34wXxdKe/Hu//dlP//lXP/X0Vz73hWeikxwgAbVUTy5TW%2beuqatKt9OWpc6gv8%2bpE3r3bL7/%2bSTN1VF7mO8b7X5/7flN%2b6Udd2xY/f3eREcxMhnTq%2bAPlkt%2bKgm2UR00HsfNGe5Hsjz8ww/91ic%2b%2bMRv/u5nPvOlZ4X5D0iAJAMcCzJKDMOs1lrdrqz0u6NBt7q5Vq1Wa/UqYnhcuEXhpT13XyEREnr%2bhh4/fjf65HIIgxABUCRX96jRHwyHuqYhudMJIclasQfip5wd3J3xg7jR3P/Yr//Gy0/%2byj9%2b8v2//%2bxf%2bMfhQ%2boAsozPMPfvvvZcYe7GjX//z7M/uvLO5auvvfijNy9c9kP/wRZkrkFcG4IVgi%2bFr6kh6m3foiObeqlBSMCwyY2Rblr9wWismb4vgBhfPVwZ/Yt5%2bJgZj0fdofrY4x/%2b7GPv%2b/RHPvDU9/4hPjUDqHhVGayvzHdq5Woxv7KY3Sqs52bvbmZW/OCIAyLnXN6g%2bkDVNCfpGXSwnQwwnpCxphlwGvreVKkwzw90tbvfzEn1ZW1QZk6Pn4BOwgG0JkCm0e5s1XY39xr7Yy2x/yQHCFCp05b%2b%2bcVzc7fuNKuVarWxeP3t%2bVu3csVV4joPQg41VI%2bzVqvVaDSGw2G3293e3t7c3Gw2m7hZqVRMy8L60/3tBbEq5VrF843VC3v5c1L5mh9EJzog0J15Y3UkjOMeZBrUwf7%2b/kBQryLLMiSDLwA1Sh3wg7DX2vnpD19448wrl8%2bcP/cvb968cHlUr8QBP/4Z3EcHYDXE/ggNpKERfBCG0w6gagbN5crPXmxdP7Mze6ZTfisIIwFcJzkAREBZF4vF9fX1nXo9TTFKFlstNF9au8iA63pJCfGhMrpxOyt3Zeg2j5jN7cri4koml6HHPIMwZ0wcC7yGNVM4mh7HIiwyoEirO3fP7l39p%2bbiOUW6DaV4YgYAr7ZDCsVCfjWP0W63keLd3V3kGi4h/Eg0Pqc8AOkMid/arV88%2b7KpqdQcu5ZmDPdl4KncpqKE7u8Bgh7YpMZwpI5T3vB9Qb34kLJvKgo8z7svA2Hc31msLp1rz720O/uD/fo7%2bKfTSohQ3mw0arXa4mKmVC7Pzs7iM3IyPz%2b/tLSUzWYlqQNRcwCjnBua1t3b9ahNbIM6JnMthj0k1A8LHBYSxt17PEaIqaEHUIoICqKD0seHer2OR0AOpoWE6yHIJponsJR6f%2b%2b94c7N/vZ1vb%2bGEj7NAZewzXJ5dXV1EaWwsgwARp1MlCaGCZF8wMSHSm4KFvAzZG7sefEwEyoLzHJ8yBXBrG6KKogxHNjb20MfIxy5XA6fUa5ra2vILWTFdBNTIWkZagZYBLtxBZIydiKzJw5QvyiZJdnalJ2tAd3o86JM27ovGUFbD5pa0DECMP%2bhmCMT41JygXy42ePP18Lvl9rf3mh8Y5O83qKIgjJUYLqIKOdABZQiMrCczSJS%2bLVQKMCHubk59Pe0A566x/RebzDQdQ0VJ3ZL7DRdAgc4jMv04%2brIKw/I0p7VGrN9wzsCFymMJtDOUmZNXRFq1CNfrwaP342fzMUfzcafysV/sxWSRLQdlATnMF2SJNgN3NzY2EAh7SQDXVfZqsBV9AZJeB5E5lljdTze2toqlUr4zmg0Qs9MEj4lLpI7M2h6h/Pnlq49/x/f%2buGlcxf%2bq5OC2/FiTsgUw3Hs4VCB7an6FXRFaMdkkkEkk7QMqjt0ShmJkkPxoCDx5fQQCfWJyoFlaIMjPSA2TNwD9PUHfUAIoNxxnInM5uLoibKUidMgzqAExpZ6MfPXL333/HeeWVxdUk4kMog5W/XBrI6h6cYQO7Sx7icZFpsvdm/yqUClGUibGN2LkKP40Qmzt269%2b%2b67aANxdjDFAwfkAUE/GYmOcFM5TZsXrbHsmTonrq4bKYyGhqFfXXnhSvbKv1769npjKz5JCwGvHMd3zcF%2bd20lo0i1Unb27uz8eDRCzKBs3WQ37JKjavhQ%2bnhiM4UrBzJYFjZSwoKjGZhsmB6gC%2bY6RuxICz3nqby/M3bVfk/IacROtYw3yudXyufPXPrY23deiU4Wc1gKWrtdr928dH5j9vrda5ffuXhdG5ncYyfBnAgnYy3Nr438xtjfVvyq4jW0cHccdoxoV/XLfW7SEFA7sdNLekzMZM1DNSqyEPvBwtD7fD7YM1jscwRrBjkf2PZs84V%2b/%2bu388%2butX5yyPAP9oDYVQSe3BrcuJT52dWVpVul4lzJNZ1TgEKQN2cNlWdbtCizfJfmJLrSJqsdkpdopkXhA552L13WkDm6oqBILRACE6ckfErqEQhYKGohp8lEzImkhqMwMuLIjiMSn5oBONBt929cWdrI1Iit6Hrfsa3THEgyYLNIscORE47dUHVDjUQ6jcYkHNjgvuCeA4zwfpUq7Z5U6O4uDNrL6v6qbSqMedO7AneqxwQPwEtZ6g8VCBbLMGz0PoACkg7iEUCB/sP3J0wMMRdIrd1b1y501ubmrty8%2bNLVYX8A2jmphNImbjUbK9lMIZ/rtJuqMsS1A05YyhQLq7ncCnAmZYwDLWFrjcJPWqvnm4tna0tntMEO98Iju7OjUqJU2sQsl0ugG3wVKAb8ShsIq4udRzDZD/j%2boCMvvPne9Vev52dLo24P3zh1%2byscAKjn84VCsbizU19f31hb36hWytnl7PydhfLW1hSRCeImrrW9dEEq/pu89Gote05X9vgpUiIVc1A%2bALiUYvAwaJVUvoPz4VK5VAKrJ7qVgh3bTfn2zXy7LjVK5dpOVdfVBJJPO1jAUsgqsB9XLI7oxEw1dLXd7oDdwFOTIhRbX%2bIau6uXpPLr8tpr0tZrhtpg/FQHLNstFgrQbdCh5XL5zp35TCaTW1kBC25ubuD%2bwsICtlD4pivUqN/akUu5Shy5FpCsK0E0HX/sLkS4f8jlR67hFEgcUn4iS7nraNU7rzTzF6Tl8/WVl7Vh/UgJHePAVqVii1LhjiO2fLppGqYFk6HjLNuxHJdxf6KFxLmBeBA0ILonOV1yjq0ict/R4qHpR3Yz03CX0hYAU5Xzajc76q4o0pJjQlP57Oh%2b%2bmAkYo75BZlWFV4esMqQr/fY1tDrmhBzftvwW7rfNQPmhUI1HXPkxGA9FAG0g0ehltxERBAhCDh/SKfTqLCOxjsaa45Ze8xqQ6o6HoKDjVw4mWJLQX16woEVNubC2u4NLr%2btqCYxdUeoHT38n7/giO6fp74fOPbvSOz0nLzgYEcOqtKz0e/s%2bL%2bTif9gmX48Q57MRl%2brhLpmiLPRh/aKKfrvuSzQGpwiVM3BQZU4G%2bXk1Zb39Frw1VL0lc3orzaDM7t%2beoKcnuo8Su/ImMMNybGNXn8Arjh4PcNY6NE4YHGIwvPE1SMsEWSP1FtKkRXuaJ68ha0wVD3CnxI2UAt5GCjG/n5P6kggcjbZ7jxyr1nTIz5csRsE8WFDiI1/bnW1sLpcmvuxlJxeyeIIIxXx5FF8T0wS6IRGQqRxHSdjOOh7w%2bqhgoUDD%2b0l388BQN9enxRk3rgAAAAASUVORK5CYII=' /%3e%3c/svg%3e" width="2560" alt="NoneBot 插件效果" data-srcset="/assets/static/nonebot-plugins.82a2fbd.84ef61192020cfd403b677d18b100f82.png 480w, /assets/static/nonebot-plugins.cbab2cf.84ef61192020cfd403b677d18b100f82.png 1024w, /assets/static/nonebot-plugins.2665e34.84ef61192020cfd403b677d18b100f82.png 1920w, /assets/static/nonebot-plugins.42db587.84ef61192020cfd403b677d18b100f82.png 2560w" data-sizes="(max-width: 2560px) 100vw, 2560px" data-src="/assets/static/nonebot-plugins.42db587.84ef61192020cfd403b677d18b100f82.png"><noscript><img class="g-image g-image--lazy g-image--loaded" src="/assets/static/nonebot-plugins.42db587.84ef61192020cfd403b677d18b100f82.png" width="2560" alt="NoneBot 插件效果"></noscript><figcaption>NoneBot 插件效果</figcaption></figure></p>
<p>本来以为这点经验写不了多少的，结果码点代码、加点注释就撑起了大半篇幅，希望读者有所收获！Python 新手难免出错，如果你发现了欢迎指正！( •̀ ω •́ )y</p>
</div><div class="post__footer"><div class="post-tags"><a href="/category/code/" class="post-tags__link category">
    code
  </a><a href="/tag/%E6%9C%BA%E5%99%A8%E4%BA%BA/" class="post-tags__link"><span>♯</span> 机器人
  </a><a href="/tag/NoneBot/" class="post-tags__link"><span>♯</span> NoneBot
  </a><a href="/tag/Pillow/" class="post-tags__link"><span>♯</span> Pillow
  </a><a href="/tag/Playwright/" class="post-tags__link"><span>♯</span> Playwright
  </a></div></div><div class="post__navigation"><!----><a href="/life/daily-death/" class="navlink" style="float: right">手帐 · 生死 ▶</a></div></div><div class="artalk-cards"><details class="admonition admonition-warning"><summary><div class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></div>
        Comment on Monstx's Blog</summary><p>
        评论发表后 UA 信息、IP
        地址会被记录，分别用于评论区展示和垃圾评论拦截。<br>
        无特殊原因评论不会被删除，你应该懂得如何发表适当的言论并对其负责。
      </p></details><div id="LetsArtalk"></div></div><!----><div class="author post-author"><a href="/" class="logo active"><img alt="Author image" src="data:image/svg+xml,%3csvg fill='none' viewBox='0 0 180 180' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-cd5267957f4a1c7ec3bcfd7ae6302b1f'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='5'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-cd5267957f4a1c7ec3bcfd7ae6302b1f)' width='180' height='180' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAAAsSAAALEgHS3X78AAAWZklEQVR42r1bCXgV1fVn8fv6t1ZrbTXsIO5IRQTBjTVAQmZewhoIYQuBJKwBLGgt1l2w0FotttT1E3erFUWlKioWBPJeAgn7KnsSwpL1JS/vvZnzP%2bfcO/PuvI2A2Pd9NzNvMvNmfr/zO8u9c2%2bzZj/iA269GXg0ua9Ra4nHWoSd80s83gs8eha2pbj/H7xmF%2b6fxq0fvwdwvxq3h7Ctw/YCtunY%2buD/r3b%2bFt1Db4nnK/fXm/3PPwSaHoY%2bJj2UB4EXulTQ7bDl4PFP8AFLYYsLYNcwgL3DAbanAWzF70U64P9EK8RG52xLBdiD5%2b3GVoz7Hu0M3ucr3C7E87qFkYFka81Dz/M/IsJUbkTWMD3qdy0Z27/wnFoGQaAJrEczhaXR4h4tiM1AQKY8bvK%2bm47h/9x6gJtHN5iUnUjYnuFElIn32oDbbNxephijpQWeiDB/KiJYbm5bes3JAsr/RmPzsHUJNFuXpS2AuHUB0gIt9iGsKccFMSYShWCD8rcAdqQJdXj0Y9gW4jmXSuD0PC1sN7nYbqFKjKyuACc/3chWIvDWwxJgtw0yGtiIZtLWrfFWNBe2VFM2%2bk4KCJpEKqmK3Mmt/YDXjg2pU7sk9MxosALtYlhe%2bnphMsnrEgn8/7At5wchqzBolrZiwXMDNyOAM2j8ngJQMBhg8wCrmVAwCH8zxSKDlOGHklRWHAJfTXHHjg1WYFZi1QVbXlFAS3mD7tj2sgXYlxl8CPh5WDwE3sUNNidiGwhm4QgIbp8NgT2PQWDf07h9BL/n83H8v4nn4T34miDHlt1EAmYSjzbSilPkFiqGC7a8BC/9S89k0ELu/pCVm2bxcLkL8GjFgiHcgrt%2bD77SL8BbfQLq6n1Q6wOobQSxbWjE48f5/8GdD6AiBmNLkorB4LrFUqP%2bpO0SHhkXPPr5ZQk7z3o4oDSX4Beyr1PKElH6vIFHBY8WN4qnQEPFZgWwwYDr6huw1fOWvvNx/r8JDSfX43WTTFaEICGIljdgH8eGtxUsCgmuJqQ5Fbxtee0Rjr50A5HCzkvu0WWfyv4d2L0I6rzVDEwFTAqIbAohdH7dWVTNg0yCVILJsQFJQOt/qLhyc6mIc4Nn4MWpzaw0x0WIyMPBEHj9vMFDNPB7HpfWDiIor5A9WZ6sTfvRGivDx%2beLa/3sOtFIwP13GEPJCEc8O3fE94h0gidnsuwjLQ8X1GTAowhvbMsTIBh8vZA4AcNtjbeBW4M/CF6fH6rr6u3/1Uo1CCLqmYS6uip2I4wjJv%2b%2bgwT9OYmtBRvYHaNqDPm9jPYevQdbuZAf3pAALhi86XCBoVB/pkTKPhJ80AQIYDtx8hScra4F%2bhAR0Unw8u9QDCFiqV6Q9zM5VonCKVuScElUFYQivi59Rb8ULz7AtbnHCnj6hVs%2bXPr7ljjA16ngEWxB0VYYnzUN7hswGAYm67Bk2bOsgvrGgE1CeGygABrY/QeRRrF4kmo1pAGxBNdvcWQGtT5QOjYy1%2bv/EJUWX3jBPh81AGLqqj9V5CRAgierb92%2bE37boze07Xwj3HBrN7i%2by23wmzYdYe6CB8FvAJ%2bnkmC7Aqmg/DuuJURdYafogEyPG8M7c6wEpWtpge8ne2JhNfyPBe/iXG8UZ2PUr%2bPgZVmQAJGF6TN7/gJoc%2b0NcFvPu%2bCWbj2gy%2b094dbud8K1N3WFTe4iVgiRUCeJs3%2bDYkntKTC3jEXDJQuyreemOkEY9H4nVs3q5GAvSnZncb%2bAGXNrF0f64fLf%2bxTL1U51SsQnP9dHjIbON3dl4EQANSKg4w23wMq332OSqpCscAJE4WRgRnhAqkBkBBG3NNGz9GhV%2bL2VxNnc7jRZKQ9dIIN7c%2bfw%2b8iOi1XHR/4vpAB8oE39oPHQi1DrB5nPQwRY/j9hSg50uP5m6HpHL5sA2icC/rP2G0AvYbXYBNgkCDfw71%2bKBPQH0WdQMaAK9nBq/Isa7B1dR9zfEurVRRIQCTDVjupQkMydGKtDE0mSJODwyggCqBEoArd6zRfQFl2A/F/Ivye06tAZXCPS%2bRw1G0Ql4Id/RCNANDEIU4etgx30LSbwZI3Bc68u0u/DOy/cY8Mbsb%2bh3xlbJ8rOiuzQSEWoZAkFvBpVAZYKKBC%2buvIt6HF3Hw6ARER65iTYe/CQHQQd4Ol6JRD6DzwXTkCUWKA9aavALnc9%2bkdC/pG%2bH1HCFgxCsMPAf/DvUH%2b6hIMPlaXemlKOxEFOR4NsRYRiQH%2bU6DKl7FXyukIEKeFYaTl8/d0GcG8p5vSngncoQE2F%2bLvUc6RYw/fzaEoc0kUsEAH%2bALafqdLvhM0rc2ZU66vgjW3TwVt1kC0pempBbIFQZwWb78Rn8sYpShYYDMFtM0Xhoz58GAkkdaoCiQiKC5Y6VJIiswBmFW8tGCXZnG34ftFGnEjhrHQ9Re33zxAVU8RoTlgJO4RvUFdXKa3oZeZrvPVQw%2bWq1VmpZ3Iayr%2bRD%2bN0H2/lfmcmCFOAVRcQEWrejwXeKoTqz2y3U6AZOysFeODVrb%2bqFkKrWf7czY0sd6MXMV7bWr6Awb5r1e12Z8UPLHlLkpYbNB56RcYBr6MSPO8WVggJ/x8Q7v/hKpBuoB%2biipfkfwW2E2L0VjciU5/lv4nU9bQtR%2bDrETC6Jvxw9DhsKdkBp6tqWLYsV2kVb%2bU%2bpf/v4oxhFqVjvCgXHRnZ1z9vEhwdIrxP1SH8/TTF5WIqQNQGXBfovcj6vfmLO3r/3o7gyGzj0XeFj3u9bO2qWi889MfHoXvve7lY6TsoGT5Y9UmoWpMPaaDfy45K1P5AnaOb6zsn8PDzRT9gkdUPsDNPHAKEG3j0WeT/uXKwI478xchNQ/k6fuiaujq29B8efQJ%2b3aYD3PTb7lywUAXX8cYusG79RlZGdZ1XPNyex%2byHswMiKsp37AMlJTacmwQHeKkyvL7x8GuhyB8fvBIHaNBEX0G9o%2bUiKNjpLw4B30INAvL5A3D42Am44677GLxVtlInph12YmbO/Z2s2Lw8fBXY82ikdcgtMED6jn0oVIVZxAqq4VauDQt49mAIXtd4ZCWn3PAiDeIpgAo90UFaRy6w1i6A3PFcAIPXkTegmixqYBzZsctRrlo1eydUwPisqdCIgVFE7QYe/Ai5QFipjMT49/9FZBY/2HHByibO5mNCWTU1J7lfISzfZPChQFjCgXAfucB%2b%2bfrKiDraYwUvCoI75nPO9/p8PFAxICkFe2m3Ys%2btN4PvdufdkND%2bWnhyyVLRafEaUH92V0RgCn8XQCCMrROg8dj7XExxbeEHu6aw9%2bne1UdR8q9jIB0jwbtoSJzeDfCWf9%2btnYsEQwb9E0RAvSiAYo/2qIVMQ8VGqGoAlLgJqz5dwwRQ3518n8AP1tK4ivP5G9ldAvsWO/wzeocqlVMsl7BFozCgPYyp8mXwHV8FvtLPMfi%2bhzX%2b3yG4E12rcLg4D/sewQKXAFskXrAaBZoNPi4JbtkvcOu1zUJlYlPG8pK45qcURq5gIAnrN26C/PsXwsTsHHj6T8vgeGkplq0mVHM1%2bKlD%2buY5X46kio4VugX1G8RboUTR5%2bDviQgyhYFDoUu8jsMMVrMuGfybUviNskpAbBLsFznBZuKtbPzxvohSuDibpU0kUMqjgNdosOqhgWr2ej%2bnTKrK1KBnNvkVWarSyMqpCDoVDDeC3prKwBs2DIWNL94Ny/JugvxhHWBheif%2bTiSQEuKqwMLqZgJ0X1NU4CRBlLf%2b/X%2bGuvKNUFN5FGqry6Dm9F5oOP4JGNtnCys2Abz9%2b9JiagsiEAZT5LLnFZR%2bPgg%2bfOoOWDC6E4zv1wom9G8N2YPbwMQBrSArsTUc%2bRjvW%2bxyuENUFxAveOqb8atmURXFHfqK7A5rQpos8TT0zZEyqg8QvcWwMYFYgNV9eujgZnmcnmk7ko3RuvrbJLbuX2fdDDnJbWFc3wSYMqgNTNc6wtQhrZCAVjA9pR0ff/PhbkxWsCCuC1gjRBXkAt/x6K/j7W5TX2OnhsYGyHelQuwusHVeFOsaBSHAbGWySEmq7ddn1w6BgpfvgRX338oSF9ZuBdOS2zPw7EEJkHH3z2Fm6vUwK%2b1GJKI1qqA1PJ19AwfFuDGA3L6EMf9AWeAF8eYneiEUS64hy%2bncDG4hYDZACdKSM19LYIvllBgqSHDfu34o7H2/P6z%2bUw9Yin49y9WeQVObOqQdgybrT%2bx7JWTe%2bwvIH9kF/vXSE7C7%2bHuYM%2bIWVEECTE5sAw%2bP7ywCYuwYIAohMfJVQC4gusKiEjTPB7xtOZITta2yEbji1JBFd8gJFHQMrVOPYI%2btToTC1%2b6Ffz99Bzw36xa4f2RH9mGSMVlyWhJZugPkJKF/97sSxt1zGRLRBp6ZPxy%2b%2b%2bwNqDxTzkH3w1eewv/9HPJSOsCkga1hUWZnaNyYws8VRwHyhYm2khTQX8hBN5r62sv%2bYbQg3ezs10Pg1JeDoWzNIDjxaSIc/WQgHF41EHa83RfWr7gbvnj2Tnjn0dvhnyjnp6bcAAtGdWJrkqQz%2b8pAhlbORRB5Q9uhvK%2bB8X2uYEvnDu0Ai/NdsPrNZ%2bHI/m2gfvaUbIQpiQlMDKsDA%2bHjk6%2bPXwuIDBAQA6T6QppMkIA7lTIQGvGygerDxPCnS3ty%2biG50oNPS2rLD0NRmdpktChJeFxf0QjopMS2CLY95CCwvBTcJreBKQN/AxMQMFk5a%2bDVMH9MN3h%2b0QT46t8vQdnRAw7QASyw6FN9tgIWZvaEyQN%2bjb/Rngmgey3P78LKi50F%2bJW%2bLIW1gdaI0Dp%2bCSreAMdVAcseLb8BLZt%2bzzUsWwI7LakdW0ttJEsCmYvk5CS1ZstO6v8rtiy1CejPuSkd4aHJ98DyR7JgzXvLYe%2b2TeCtrXKANk0TgoEA%2bBt9/L2uphL%2bOK2/uB7vQ6TnDhXZ4fNlPe0sEB28xmUwklOO36%2b03gr9PiwQmrEUwD%2bMN6DoTIzn4Y1zktuhn/4KMu66lIGRJa1Gx6dgxM7TOsHvMu6Ap1HOLy6ewZLesmENlB7ZZwNTP4YRhGAwgFsDjGCQt/QpPbofHsq6F8H/0gZPyqNGhiDXs4qhGAoIyMHfj9RB0duUStCMpQKVgJcXdoVMJICsm5V4Dbzx3APw7acrYdVrz7Al1370Mvz387egZPNXsG/7Zig/fhB8DV6I9bEBI1jTNNjqZhC3Ejh9/rvmbZjh6gyT%2bl3lAG/5P6fAwjBXdUR/LeKNcejNsFv/Xr4SC8bLBhYBa5/vhQEsgX1/ChKwKLsvlB7aA%2bf6EDACaYElyzJYarQfFE39HNxZCEsXjILx912BbtQK40d7GzzLHwmgYPo9lcKx5C8MLAsg/Sy2BHumpSRCGRmK7gZ26kMfKsOSlJgXD9Ae0vv8ApYN7Q6%2blR%2bD78wZ7h8QDAOtaaD/UjOpkYWpBeQ2zMq2InyN0FhQAiee%2bivkD%2bkI4/pczlafhu6mgres/9ik6%2bN1hEx7JEhY/2X7laBpzbd1a1dgK%2bU87rbHBmKTgFH0hbld2A2mowomJCXA31y94WzadCjLXgjVr74PjTv3gelrhKZ%2bghWnof77Qqha8RZUzHoETg7Pg/2pk2De0OtganJbG7Tl81ajbLP7vX529I9IgW77nYD1eqyHOoFKUYG%2bSAZDf7xgyDfBYofyPVsBM8CEIVfD8667oGr8AjiRPgNKU6dC2ajpUDH7Eahc%2biLUvLUKvGvWQQMCrFu7AWo%2b/xrqPvsGat75BCqffQVOL1wM5ZPuh9K0HL62lK7NnAsHM6bDvOTrYMqQ1g7QdF9yv4w%2bCfDeY7c7pO%2b0vtXz02Xw0z%2bSrwJbiNfj6lQ4D6rAI1XgnBAVUQRZsWDVkh4w7r5WMCn5GiSgN1SNQxAZs6EcH748Yw6TwKBcCMqVDWUj8uDQnTrs69gLjvUfA2XD8H9p0/h42ZhZUD4un68tGzcHKjLy4eCYXCSgs4MACzzFoMVTb4xapUL4i1FrVrpH6y6xtrAnQYdNkJjqiAVuZy8xvFNDQWXFvK4w/L6r4IW0u6CSCBg7C8rGzmYCyhFIeaYAxeAmzIcj/dPhQNeBcCJtKn/n49TofNno%2bmgE2ODR9R7KuBZq1yXzM8QYA7Cszy9F0erLw%2bIe/tk6zF74EJp2rn8DO9WRYi2qCgyrY4O9vyUzr4Mlg3pCdWYYAQogPoZEHOk3CvZ36Q/H9Sxh7bBzYxGQgwRwwYOyf3TidVD1TRIH5GBc8JjVirnndxS/X27NdndMlgqt%2brCnxN7IAyVFsusYxxWsAQufJwnWP5AEJ0fNQ/ki2Iw4BPQ9fwKmJovymqo9Cr7c4QkDHyZ9K/cb6stQRenRJ0bbcwTd2kQZNILOIilyQMPYjMe2p0Dw3Qw4MZzkTIAuHgFzkYCxfa%2bBmVp7WPtcL9HbLNIdsneC1xzzARDTM2FTAKPPExRukBI60a09y5MNPfZssagkmAU0mDEUvCvHQOmIuUxA2dg5F4WAA%2bm5MB/T4IoFXeD0l0M48HIqjprzldTt1hrl668vI%2bZCxppCHwqImqqMD8TUeL0xJgmSgIa3iICLpAC8/uTYfDg2IQ%2bOf4C%2bvl2MOQQLtFgFjxqs/bJzt5sym5X24oKPWCMgCyTJ3Bo599bv9C9JAhOQAr73R0PpyCYQwEFwQBwCxPVlo%2bfAqdwZAAVpYHi0WJIPB98oAzitQksIl/451w%2boqyzsdThb0%2bjiD%2bUiiYA9dVbemAnYmgL%2bz0aIBx8bAhGNgMN9RsL%2bm/rEJ4DcaFQ%2bnM7PJR%2b2h97UN0CiurNTncmWp8UTbHm9VQT4pq4eoUnFZmj6bAuFnOe5RghbM2DyMDNuN7qgImcGlKVHElBuEYD5/riWBYfuSeNqzyLHqZY5TEDp8LlQvXgyuxeRrAB3Wt3N4xhBOTn6W2yXq9P/yLXNC1k5okygVkig9YCoALFWyC%2bG0tgNTHQDs%2brJyfzgoUAY6Qpq4RNL/pYCyK3IvUIEKIs0eCIkWp0qV5a9/oK6rvBHryIzPaGLTVoqZwcSvRsvkyOXKOKy2c8EFKMbrB5pogLMkAJCSrDAWu6gfrfAW9Zn%2bc/JlTO9WPZCaaFhLTGIK9YyVOD/xihrGy/eEjrwpKjlMrVLlKxBa/dq%2bCEKWQV%2bJMGoeiLLLB2GKsicbarxIJwA576iGJI/BlPfu%2blkfZPJ9fAaAEMurDS5RuGZLfqr1hJbuYiyue3zu8Zc3BWjyuCJsnZQa4Px4nmeZkdEbMO6/HtX8NT06QF0BYNIQFBmuQAn9qNFfGl5bGZp2lyo%2bfNEU4I38N4Baqw2ikFF3GX/mNYkq5I3145XDKU1u%2bgftb8gl6a1VAjqiN%2bfxAc%2bDHtoxHUU1MzDbnHaXLNszJwAgqQWRKBGiARJyDjRykbnG6icYPWSSQHYkuLnRVDWumMxkFHJFndrd4YtnW3%2bk60aPdeqcVPMug4pojjlUswGw3H7Jm6PepdlgS93PtRPWADV4%2bfDGaubjMCRGMz1%2bVA2ci5UjJ4HNTNnAbyfCXAgVawMFbM6T%2bE9PhOLsUVqswIzpWnYlNYsam3/05OgORinMQVTWU/Mx04NvAwqBvaqf31s/unZea%2bjlYvQ4mXY/ETCyYmzzIqc6ebZB6f6vS%2bNO2NscB2E7UMLUUXvovUfRPCJ6PdXhamwJViDGWGB%2bkI%2b/w80aeNFRFgq7gAAAABJRU5ErkJggg==' /%3e%3c/svg%3e" width="180" data-src="/assets/static/favicon.e6b6009.bb50f1698dfbcf84ee87f384c80e7647.png" data-srcset="/assets/static/favicon.e6b6009.bb50f1698dfbcf84ee87f384c80e7647.png 180w" data-sizes="(max-width: 180px) 100vw, 180px" class="author__image g-image g-image--lazy g-image--loading"><noscript><img src="/assets/static/favicon.e6b6009.bb50f1698dfbcf84ee87f384c80e7647.png" class="author__image g-image g-image--loaded" width="180" alt="Author image"></noscript></a><!----><p class="author__intro">一只怠惰的臭弟弟 つ﹏⊂</p><p class="author__links"><a href="/feed.xml" target="_blank" style="color:#f5a623;"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="rss" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="svg-inline--fa fa-rss fa-w-14"><path fill="currentColor" d="M128.081 415.959c0 35.369-28.672 64.041-64.041 64.041S0 451.328 0 415.959s28.672-64.041 64.041-64.041 64.04 28.673 64.04 64.041zm175.66 47.25c-8.354-154.6-132.185-278.587-286.95-286.95C7.656 175.765 0 183.105 0 192.253v48.069c0 8.415 6.49 15.472 14.887 16.018 111.832 7.284 201.473 96.702 208.772 208.772.547 8.397 7.604 14.887 16.018 14.887h48.069c9.149.001 16.489-7.655 15.995-16.79zm144.249.288C439.596 229.677 251.465 40.445 16.503 32.01 7.473 31.686 0 38.981 0 48.016v48.068c0 8.625 6.835 15.645 15.453 15.999 191.179 7.839 344.627 161.316 352.465 352.465.353 8.618 7.373 15.453 15.999 15.453h48.068c9.034-.001 16.329-7.474 16.005-16.504z"></path></svg></a><a href="/archives" style="color:var(--title-color);"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="archive" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svg-inline--fa fa-archive fa-w-16"><path fill="currentColor" d="M32 448c0 17.7 14.3 32 32 32h384c17.7 0 32-14.3 32-32V160H32v288zm160-212c0-6.6 5.4-12 12-12h104c6.6 0 12 5.4 12 12v8c0 6.6-5.4 12-12 12H204c-6.6 0-12-5.4-12-12v-8zM480 32H32C14.3 32 0 46.3 0 64v48c0 8.8 7.2 16 16 16h480c8.8 0 16-7.2 16-16V64c0-17.7-14.3-32-32-32z"></path></svg></a><a href="/watch" style="color:#06a878;"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="dragon" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" class="svg-inline--fa fa-dragon fa-w-20"><path fill="currentColor" d="M18.32 255.78L192 223.96l-91.28 68.69c-10.08 10.08-2.94 27.31 11.31 27.31h222.7c-9.44-26.4-14.73-54.47-14.73-83.38v-42.27l-119.73-87.6c-23.82-15.88-55.29-14.01-77.06 4.59L5.81 227.64c-12.38 10.33-3.45 30.42 12.51 28.14zm556.87 34.1l-100.66-50.31A47.992 47.992 0 0 1 448 196.65v-36.69h64l28.09 22.63c6 6 14.14 9.37 22.63 9.37h30.97a32 32 0 0 0 28.62-17.69l14.31-28.62a32.005 32.005 0 0 0-3.02-33.51l-74.53-99.38C553.02 4.7 543.54 0 533.47 0H296.02c-7.13 0-10.7 8.57-5.66 13.61L352 63.96 292.42 88.8c-5.9 2.95-5.9 11.36 0 14.31L352 127.96v108.62c0 72.08 36.03 139.39 96 179.38-195.59 6.81-344.56 41.01-434.1 60.91C5.78 478.67 0 485.88 0 494.2 0 504 7.95 512 17.76 512h499.08c63.29.01 119.61-47.56 122.99-110.76 2.52-47.28-22.73-90.4-64.64-111.36zM489.18 66.25l45.65 11.41c-2.75 10.91-12.47 18.89-24.13 18.26-12.96-.71-25.85-12.53-21.52-29.67z"></path></svg></a><a href="/friends" style="color:#ff0000;"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="heart" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svg-inline--fa fa-heart fa-w-16"><path fill="currentColor" d="M462.3 62.6C407.5 15.9 326 24.3 275.7 76.2L256 96.5l-19.7-20.3C186.1 24.3 104.5 15.9 49.7 62.6c-62.8 53.6-66.1 149.8-9.9 207.9l193.5 199.8c12.5 12.9 32.8 12.9 45.3 0l193.5-199.8c56.3-58.1 53-154.3-9.8-207.9z"></path></svg></a><a href="/about"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="id-badge" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" class="svg-inline--fa fa-id-badge fa-w-12"><path fill="currentColor" d="M336 0H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zM144 32h96c8.8 0 16 7.2 16 16s-7.2 16-16 16h-96c-8.8 0-16-7.2-16-16s7.2-16 16-16zm48 128c35.3 0 64 28.7 64 64s-28.7 64-64 64-64-28.7-64-64 28.7-64 64-64zm112 236.8c0 10.6-10 19.2-22.4 19.2H102.4C90 416 80 407.4 80 396.8v-19.2c0-31.8 30.1-57.6 67.2-57.6h5c12.3 5.1 25.7 8 39.8 8s27.6-2.9 39.8-8h5c37.1 0 67.2 25.8 67.2 57.6v19.2z"></path></svg></a></p></div></div></main><footer class="footer"><div class="footer__copyright"><a href="http://www.beian.miit.gov.cn/" target="_blank" rel="nofollow noopener noreferrer" style="text-decoration: none; cursor: default">皖 ICP 备 18021272 号 - 1</a>
      © 2014 - 2021
    </div><div class="footer__links"><a href="https://gridsome.org" target="_blank" rel="nofollow noopener noreferrer">Gridsome</a>
      ×
      <a href="https://github.com/spencerwooo" target="_blank" rel="nofollow noopener noreferrer">SpencerWoo</a>
      ×
      <a href="https://promotion.aliyun.com/ntms/act/ambassador/sharetouser.html?userCode=ztik1iwq&utm_source=ztik1iwq" target="_blank" rel="nofollow noopener noreferrer">Aliyun</a>
      ×
      <a href="https://www.dogedoge.com" target="_blank" rel="nofollow noopener noreferrer">DogeDoge</a></div></footer></div> <script src="/assets/js/app.ca25ae24.js" defer></script><script src="/assets/js/page--src--templates--blog-post-vue.5b922b7e.js" defer></script>
  </body>
</html>
